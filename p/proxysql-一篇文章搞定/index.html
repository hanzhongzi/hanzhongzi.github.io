<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ProxySql ÂÆâË£ÖÈÉ®ÁΩ≤„ÄÅÈÖçÁΩÆ'>
<title>ProxySql ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö</title>

<link rel='canonical' href='https://hanzhongzi.github.io/p/proxysql-%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E5%AE%9A/'>

<link rel="stylesheet" href="/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css"><meta property='og:title' content='ProxySql ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö'>
<meta property='og:description' content='ProxySql ÂÆâË£ÖÈÉ®ÁΩ≤„ÄÅÈÖçÁΩÆ'>
<meta property='og:url' content='https://hanzhongzi.github.io/p/proxysql-%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E5%AE%9A/'>
<meta property='og:site_name' content='ÁÄö‰∏≠Â≠êÁöÑ‰∏™‰∫∫ÁΩëÁ´ô'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='proxysql' /><meta property='article:published_time' content='2024-01-02T16:55:27&#43;08:00'/><meta property='article:modified_time' content='2024-01-02T16:55:27&#43;08:00'/>
<meta name="twitter:title" content="ProxySql ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö">
<meta name="twitter:description" content="ProxySql ÂÆâË£ÖÈÉ®ÁΩ≤„ÄÅÈÖçÁΩÆ">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu190e528798e90195d3cefef01f0a2d44_410_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ÁÄö‰∏≠Â≠êÁöÑ‰∏™‰∫∫ÁΩëÁ´ô</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://hanzhongzi.github.io/" selected>‰∏≠Êñá</option>
                        
                            <option value="https://hanzhongzi.github.io/en/" >English</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#‰∏ãËΩΩ‰∏éÂÆâË£Ö">‰∏ãËΩΩ‰∏éÂÆâË£Ö</a>
      <ol>
        <li><a href="#ubuntu">Ubuntu</a>
          <ol>
            <li><a href="#‰∏ãËΩΩ">‰∏ãËΩΩ</a></li>
            <li><a href="#ÂÆâË£Ö">ÂÆâË£Ö</a></li>
          </ol>
        </li>
        <li><a href="#centos8">Centos8</a>
          <ol>
            <li><a href="#‰∏ãËΩΩ-1">‰∏ãËΩΩ</a></li>
            <li><a href="#ÂÆâË£Ö-1">ÂÆâË£Ö</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ÂêØÂä®">ÂêØÂä®</a></li>
    <li><a href="#ÁôªÂΩï">ÁôªÂΩï</a></li>
    <li><a href="#Â§öÂ±ÇÁöÑÈÖçÁΩÆÁ≥ªÁªü">Â§öÂ±ÇÁöÑÈÖçÁΩÆÁ≥ªÁªü</a></li>
    <li><a href="#ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ">ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ</a></li>
    <li><a href="#Â∞Ü‰∏™ÊúçÂä°Âô®Ê∑ªÂä†Âà∞mysql_serverË°®">Â∞Ü‰∏™ÊúçÂä°Âô®Ê∑ªÂä†Âà∞mysql_serverË°®</a></li>
    <li><a href="#proxysql-ÁõëÊéßÂêéÁ´ØËäÇÁÇπ">ProxySQL ÁõëÊéßÂêéÁ´ØËäÇÁÇπ</a></li>
    <li><a href="#ÈÖçÁΩÆproxy">ÈÖçÁΩÆproxy</a>
      <ol>
        <li><a href="#ÈÖçÁΩÆËØªÂÜôÂàÜÁ¶ª">ÈÖçÁΩÆËØªÂÜôÂàÜÁ¶ª</a>
          <ol>
            <li><a href="#Ë∑ØÁî±ËßÑÂàô">Ë∑ØÁî±ËßÑÂàô</a></li>
            <li><a href="#ËßÑÂàôÁöÑÂÜôÂÖ•">ËßÑÂàôÁöÑÂÜôÂÖ•</a></li>
            <li><a href="#ËØªÂÜôÂàÜÁ¶ªÊµãËØï">ËØªÂÜôÂàÜÁ¶ªÊµãËØï</a></li>
            <li><a href="#Êü•ÁúãË∑ØÁî±‰ø°ÊÅØ">Êü•ÁúãË∑ØÁî±‰ø°ÊÅØ</a></li>
          </ol>
        </li>
        <li><a href="#ÊÄªÁªì">ÊÄªÁªìÔºö</a>
          <ol>
            <li><a href="#ÈÅáÂà∞ÁöÑÈóÆÈ¢ò">ÈÅáÂà∞ÁöÑÈóÆÈ¢ò</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#proxysql-ÁöÑÈ´òÂèØÁî®">ProxySql ÁöÑÈ´òÂèØÁî®</a>
      <ol>
        <li><a href="#Áõ∏ÂÖ≥ÂèòÈáè">Áõ∏ÂÖ≥ÂèòÈáè</a>
          <ol>
            <li><a href="#1Áî®‰∫éÂêåÊ≠•ÁöÑÂèòÈáè">1.Áî®‰∫éÂêåÊ≠•ÁöÑÂèòÈáè</a></li>
            <li><a href="#2ÈõÜÁæ§Âá≠ËØÅÂèòÈáè">2.ÈõÜÁæ§Âá≠ËØÅÂèòÈáè</a></li>
            <li><a href="#3Ê£ÄÊü•È¢ëÁéáÂíåÈó¥ÈöîÊó∂Èó¥">3.Ê£ÄÊü•È¢ëÁéáÂíåÈó¥ÈöîÊó∂Èó¥</a></li>
            <li><a href="#4Â∞ÜÈÖçÁΩÆÂêåÊ≠•Âà∞Á£ÅÁõò">4.Â∞ÜÈÖçÁΩÆÂêåÊ≠•Âà∞Á£ÅÁõò</a></li>
            <li><a href="#5ÊòØÂê¶ÈúÄË¶ÅËøúÁ®ãÂêåÊ≠•ÂèòÈáè">5.ÊòØÂê¶ÈúÄË¶ÅËøúÁ®ãÂêåÊ≠•ÂèòÈáè</a></li>
            <li><a href="#6Âª∂ËøüÂêåÊ≠•">6.Âª∂ËøüÂêåÊ≠•</a></li>
          </ol>
        </li>
        <li><a href="#ÈúÄË¶ÅÈÖçÁΩÆÁöÑË°®">ÈúÄË¶ÅÈÖçÁΩÆÁöÑË°®</a>
          <ol>
            <li><a href="#1proxysql_servers">1.proxysql_servers</a></li>
            <li><a href="#2runtime_proxysql_servers">2.runtime_proxysql_servers</a></li>
            <li><a href="#3runtime_checksums_values">3.runtime_checksums_values</a></li>
          </ol>
        </li>
        <li><a href="#stats-tables">stats tables</a>
          <ol>
            <li><a href="#1stats_proxysql_servers_checksums">1.stats_proxysql_servers_checksums</a></li>
            <li><a href="#2stats_proxysql_servers_metrics-Ë°®">2.<strong>stats_proxysql_servers_metrics Ë°®</strong></a></li>
            <li><a href="#3stats_proxysql_servers_status">3.stats_proxysql_servers_status</a></li>
            <li><a href="#re-configuration">Re-configuration</a></li>
            <li><a href="#ËøõË°åÈÖçÁΩÆ">ËøõË°åÈÖçÁΩÆ</a></li>
            <li><a href="#ËßÇÂØüÈõÜÁæ§Áä∂ÂÜµ">ËßÇÂØüÈõÜÁæ§Áä∂ÂÜµ</a></li>
            <li><a href="#proxysqlÁöÑÈ´òÂèØÁî®">ProxysqlÁöÑÈ´òÂèØÁî®</a></li>
          </ol>
        </li>
        <li><a href="#keepalived-ÂÆòÊñπÁΩëÁ´ô-httpswwwkeepalivedorg">Keepalived ÂÆòÊñπÁΩëÁ´ô <a href="https://www.keepalived.org/">https://www.keepalived.org/</a></a>
          <ol>
            <li><a href="#vrrpÁöÑÂü∫Êú¨Êû∂ÊûÑ">VRRPÁöÑÂü∫Êú¨Êû∂ÊûÑ</a></li>
            <li><a href="#Â∑•‰ΩúÁ±ªÂûã">Â∑•‰ΩúÁ±ªÂûã</a></li>
          </ol>
        </li>
        <li><a href="#Ê£ÄÊü•">Ê£ÄÊü•</a></li>
        <li><a href="#ÈÅáÂà∞ÁöÑÈóÆÈ¢ò-1">ÈÅáÂà∞ÁöÑÈóÆÈ¢ò</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/linux-operator/" >
                Linux operator
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/proxysql-%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E5%AE%9A/">ProxySql ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ProxySql ÂÆâË£ÖÈÉ®ÁΩ≤„ÄÅÈÖçÁΩÆ
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 29, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 19 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="proxysql">ProxySQL</h1>
<p>ÁÆÄÂçï‰ªãÁªç: ProxySQL ÊòØÂü∫‰∫é MySQL ÁöÑ‰∏ÄÊ¨æÂºÄÊ∫êÁöÑ‰∏≠Èó¥‰ª∂ÁöÑ‰∫ßÂìÅÔºåÊòØ‰∏Ä‰∏™ÁÅµÊ¥ªÁöÑ MySQL ‰ª£ÁêÜÂ±ÇÔºåÂèØ‰ª•ÂÆûÁé∞ËØªÂÜôÂàÜÁ¶ªÔºåÊîØÊåÅ Query Ë∑ØÁî±ÂäüËÉΩÔºåÊîØÊåÅÂä®ÊÄÅÊåáÂÆöÊüê‰∏™ SQL ËøõË°åÁºìÂ≠òÔºåÊîØÊåÅÂä®ÊÄÅÂä†ËΩΩÔºàÊó†ÈúÄÈáçÂêØ ProxySQL ÊúçÂä°ÔºâÔºåÊïÖÈöúÂàáÊç¢Âíå‰∏Ä‰∫õ SQL ÁöÑËøáÊª§ÂäüËÉΩ„ÄÇ</p>
<p>githubÂú∞ÂùÄÔºöhttps://github.com/sysown/proxysql/releases</p>
<p>ÂÆòÊñπÊñáÊ°£: <a class="link" href="https://proxysql.com/documentation/"  target="_blank" rel="noopener"
    >https://proxysql.com/documentation/</a></p>
<h2 id="‰∏ãËΩΩ‰∏éÂÆâË£Ö">‰∏ãËΩΩ‰∏éÂÆâË£Ö</h2>
<h3 id="ubuntu">Ubuntu</h3>
<blockquote>
<h4 id="‰∏ãËΩΩ">‰∏ãËΩΩ</h4>
<p><code>wget  https://github.com/sysown/proxysql/releases/download/v2.0.14/proxysql_2.0.14-dbg-ubuntu16_amd64.deb </code></p>
<h4 id="ÂÆâË£Ö">ÂÆâË£Ö</h4>
<p><code>dpkg -i proxysql_2.0.14-dbg-ubuntu16_amd64.deb</code></p>
</blockquote>
<h3 id="centos8">Centos8</h3>
<blockquote>
<h4 id="‰∏ãËΩΩ-1">‰∏ãËΩΩ</h4>
<p>wget <a class="link" href="https://github.com/sysown/proxysql/releases/download/v2.0.14/proxysql-2.0.14-1-dbg-centos8.x86_64.rpm"  target="_blank" rel="noopener"
    >https://github.com/sysown/proxysql/releases/download/v2.0.14/proxysql-2.0.14-1-dbg-centos8.x86_64.rpm</a></p>
<h4 id="ÂÆâË£Ö-1">ÂÆâË£Ö</h4>
<p><code> yum -y install proxysql-2.0.14-1-centos8.x86_64.rpm</code></p>
</blockquote>
<p>centos7 : <a class="link" href="https://github.com/sysown/proxysql/releases/download/v2.0.14/proxysql-2.0.14-1-centos7.x86_64.rpm"  target="_blank" rel="noopener"
    >https://github.com/sysown/proxysql/releases/download/v2.0.14/proxysql-2.0.14-1-centos7.x86_64.rpm</a></p>
<h2 id="ÂêØÂä®">ÂêØÂä®</h2>
<p>ÂêØÂä®Ôºö<code>systemctl restart proxysql</code></p>
<p>ÂÅúÊ≠¢:  <code>systemctl stop proxysql</code></p>
<p>ÈªòËÆ§ÁõëÂê¨ <code>6032</code> Âíå <code>6033</code> Á´ØÂè£,<code>6032 </code>ÊòØ ProxySQL ÁöÑÁÆ°ÁêÜÁ´ØÂè£Âè∑Ôºå<code>6033</code>ÊòØÂØπÂ§ñÊúçÂä°ÁöÑÁ´ØÂè£Âè∑
ProxySQL ÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÈÉΩÊòØÈªòËÆ§ÁöÑ <code>admin</code>„ÄÇ</p>
<h2 id="ÁôªÂΩï">ÁôªÂΩï</h2>
<p>ÈúÄË¶ÅÊúâmysqlÁöÑÂÆ¢Êà∑Á´Ø</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="n">proxysql</span><span class="p">]</span><span class="c1"># mysql -u admin -padmin -h 127.0.0.1 -P 6032 --prompt=&#39;ProxySQL-Admin&gt;  &#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">show</span> <span class="n">databases</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----+---------------+-------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">seq</span> <span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">file</span>                                <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----+---------------+-------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="n">main</span>          <span class="o">|</span>  <span class="err">ÂÜÖÂ≠òÈÖçÁΩÆÊï∞ÊçÆÂ∫ìÔºåÂç≥</span> <span class="n">MEMORY</span><span class="err">ÔºåË°®ÈáåÂ≠òÊîæÂêéÁ´Ø</span> <span class="n">db</span> <span class="err">ÂÆû‰æã„ÄÅÁî®Êà∑È™åËØÅ„ÄÅË∑ØÁî±ËßÑÂàôÁ≠â‰ø°ÊÅØ„ÄÇ</span>   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">disk</span>          <span class="o">|</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">proxysql</span><span class="o">/</span><span class="n">proxysql</span><span class="o">.</span><span class="n">db</span> <span class="err">ÊåÅ‰πÖÂåñÁöÑÁ£ÅÁõòÁöÑÈÖçÁΩÆ</span>       <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span> <span class="n">stats</span>         <span class="o">|</span>   <span class="err">ÁªüËÆ°‰ø°ÊÅØÁöÑÊ±áÊÄª</span>           <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">4</span>   <span class="o">|</span> <span class="n">monitor</span>       <span class="o">|</span> <span class="err">‰∏Ä‰∫õÁõëÊéßÁöÑÊî∂ÈõÜ‰ø°ÊÅØÔºåÊØîÂ¶ÇÊï∞ÊçÆÂ∫ìÁöÑÂÅ•Â∫∑Áä∂ÊÄÅÁ≠â</span>  <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="n">stats_history</span> <span class="o">|</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">proxysql</span><span class="o">/</span><span class="n">proxysql_stats</span><span class="o">.</span><span class="n">dbËøô‰∏™Â∫ìÊòØ</span> <span class="n">ProxySQL</span> <span class="err">Êî∂ÈõÜÁöÑÊúâÂÖ≥ÂÖ∂ÂÜÖÈÉ®ÂäüËÉΩÁöÑÂéÜÂè≤ÊåáÊ†á</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----+---------------+-------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>note: If your MySQL client version is version 8.04 or higher add <code>--default-auth=mysql_native_password</code> to the above command to connect to the admin interface.</p>
<p>ËøôÈáåÈù¢Êúâ5‰∏™Êï∞ÊçÆÂ∫ì</p>
<p>main: ÂÜÖÂ≠òÈÖçÁΩÆÊï∞ÊçÆÂ∫ìÔºåÂç≥ MEMORYÔºåË°®ÈáåÂ≠òÊîæÂêéÁ´Ø db ÂÆû‰æã„ÄÅÁî®Êà∑È™åËØÅ„ÄÅË∑ØÁî±ËßÑÂàôÁ≠â‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">use</span> <span class="n">main</span>
</span></span><span class="line"><span class="cl"><span class="n">Reading</span> <span class="n">table</span> <span class="n">information</span> <span class="k">for</span> <span class="n">completion</span> <span class="n">of</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">column</span> <span class="n">names</span>
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="n">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="n">with</span> <span class="o">-</span><span class="n">A</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Database</span> <span class="n">changed</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">show</span> <span class="n">tables</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+----------------------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">tables</span>                                             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+----------------------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">global_variables</span>                                   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_aws_aurora_hostgroups</span>                        <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_collations</span>                                   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_firewall_whitelist_rules</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_firewall_whitelist_sqli_fingerprints</span>         <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_firewall_whitelist_users</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_galera_hostgroups</span>                            <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_group_replication_hostgroups</span>                 <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_query_rulesÊåáÂÆö</span> <span class="n">Query</span> <span class="err">Ë∑ØÁî±Âà∞ÂêéÁ´Ø‰∏çÂêåÊúçÂä°Âô®ÁöÑËßÑÂàôÂàóË°®</span><span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_query_rules_fast_routing</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_replication_hostgroups</span> <span class="err">ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ</span>         <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_serversÂêéÁ´ØÂèØ‰ª•ËøûÊé•</span> <span class="n">MySQL</span> <span class="err">ÊúçÂä°Âô®ÁöÑÂàóË°®</span>            <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql_usersÈÖçÁΩÆÂêéÁ´ØÊï∞ÊçÆÂ∫ìÁöÑË¥¶Âè∑ÂíåÁõëÊéßÁöÑË¥¶Âè∑</span><span class="err">„ÄÇ</span>             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">proxysql_servers</span>                                   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">restapi_routes</span>                                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_checksums_values</span>                           <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_global_variables</span>                           <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_aws_aurora_hostgroups</span>                <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_firewall_whitelist_rules</span>             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_firewall_whitelist_sqli_fingerprints</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_firewall_whitelist_users</span>             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_galera_hostgroups</span>                    <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_group_replication_hostgroups</span>         <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_query_rules</span>                          <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_query_rules_fast_routing</span>             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_replication_hostgroups</span>               <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_servers</span>                              <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_mysql_users</span>                                <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_proxysql_servers</span>                           <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_restapi_routes</span>                             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">runtime_scheduler</span>                                  <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">scheduler</span>                                          <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+----------------------------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">32</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê≥®ÊÑè</strong>Ôºö Ë°®Âêç‰ª• runtime_ÂºÄÂ§¥ÁöÑË°®Á§∫ ProxySQL ÂΩìÂâçËøêË°åÁöÑÈÖçÁΩÆÂÜÖÂÆπÔºå‰∏çËÉΩÈÄöËøá DML ËØ≠Âè•‰øÆÊîπ„ÄÇ</p>
<p>Âè™ËÉΩ‰øÆÊîπÂØπÂ∫îÁöÑ‰∏ç‰ª• runtime ÂºÄÂ§¥ÁöÑË°®ÔºåÁÑ∂Âêé ‚ÄúLOAD‚Äù ‰ΩøÂÖ∂ÁîüÊïàÔºå‚ÄúSAVE‚Äù ‰ΩøÂÖ∂Â≠òÂà∞Á°¨Áõò‰ª•‰æõ‰∏ãÊ¨°ÈáçÂêØÂä†ËΩΩ„ÄÇ</p>
<h2 id="Â§öÂ±ÇÁöÑÈÖçÁΩÆÁ≥ªÁªü">Â§öÂ±ÇÁöÑÈÖçÁΩÆÁ≥ªÁªü</h2>
<p><img src="C:%5cUsers%5cAdministrator%5cDesktop%5c1033265-20200210150442128-1932198210.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Êï¥Â•óÈÖçÁΩÆÁ≥ªÁªüÂàÜ‰∏∫‰∏âÂ±ÇÔºöÈ°∂Â±Ç‰∏∫ RUNTIME ,‰∏≠Èó¥Â±Ç‰∏∫ MEMORY , Â∫ïÂ±Ç‰πüÂ∞±ÊòØÊåÅ‰πÖÂ±Ç DISK Âíå CONFIG FILE „ÄÇ</p>
<p>RUNTIME Ôºö ‰ª£Ë°® ProxySQL ÂΩìÂâçÁîüÊïàÁöÑÊ≠£Âú®‰ΩøÁî®ÁöÑÈÖçÁΩÆÔºåÊó†Ê≥ïÁõ¥Êé•‰øÆÊîπËøôÈáåÁöÑÈÖçÁΩÆÔºåÂøÖÈ°ªË¶Å‰ªé‰∏ã‰∏ÄÂ±Ç ‚Äúload‚Äù ËøõÊù•„ÄÇ
MEMORYÔºö MEMORY Â±Ç‰∏äÈù¢ËøûÊé• RUNTIME Â±ÇÔºå‰∏ãÈù¢ËøûÊé•ÊåÅ‰πÖÂ±Ç„ÄÇËøôÂ±ÇÂèØ‰ª•Ê≠£Â∏∏Êìç‰Ωú ProxySQL  ÈÖçÁΩÆÔºåÈöè‰æø‰øÆÊîπÔºå‰∏ç‰ºöÂΩ±ÂìçÁîü‰∫ßÁéØÂ¢É„ÄÇ‰øÆÊîπ‰∏Ä‰∏™ÈÖçÁΩÆ‰∏ÄËà¨ÈÉΩÊòØÁé∞Âú® MEMORY Â±ÇÂÆåÊàêÁöÑÔºåÁ°ÆËÆ§Ê≠£Â∏∏‰πãÂêéÂú®Âä†ËΩΩËææÂà∞ RUNTIME Âíå ÊåÅ‰πÖÂåñÁöÑÁ£ÅÁõò‰∏ä„ÄÇ</p>
<p>DISK Âíå CONFIG FILEÔºöÊåÅ‰πÖÂåñÈÖçÁΩÆ‰ø°ÊÅØÔºåÈáçÂêØÂêéÂÜÖÂ≠ò‰∏≠ÁöÑÈÖçÁΩÆ‰ø°ÊÅØ‰ºö‰∏¢Â§±ÔºåÊâÄÈúÄË¶ÅÂ∞ÜÈÖçÁΩÆ‰ø°ÊÅØ‰øùÁïôÂú®Á£ÅÁõò‰∏≠„ÄÇÈáçÂêØÊó∂ÔºåÂèØ‰ª•‰ªéÁ£ÅÁõòÂø´ÈÄüÂä†ËΩΩÂõûÊù•„ÄÇ</p>
<p>‰∏ÄËà¨Âú®ÂÜÖÂ≠òÈÇ£Â±Ç‰øÆÊîπ ,ÁÑ∂Âêé‰øùÂ≠òÂà∞ËøêË°åÁ≥ªÁªüÔºå‰øùÂ≠òÂà∞Á£ÅÁõòÊï∞ÊçÆÂ∫ìÁ≥ªÁªü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="nb">load</span> <span class="n">xxx</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">save</span> <span class="n">xxx</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>proxysql ÂêØÂä®Êó∂ÔºåÈ¶ñÂÖàÂéªÊâæ/etc/proxysql.cnf ÊâæÂà∞ÂÆÉÁöÑdatadir,Â¶ÇÊûúdatadir‰∏ãÊúâproxysql.db Â∞±Âä†ËΩΩproxysql.dbÁöÑÈÖçÁΩÆ</li>
<li>Â¶ÇÊûúÂêØÂä®proxysqlÊó∂Â∏¶Êúâ<code>--init</code>Ê†áÂøóÔºå‰ºöÁî®/etc/proxsql.cnfÁöÑÈÖçÁΩÆÔºåÊääRuntimeÔºådiskÂÖ®ÈÉ®ÂàùÂßãÂåñ‰∏Ä‰∏ã</li>
<li>Âú®Ë∞ÉÁî®ÊòØË∞ÉÁî®<code>--reload</code> ‰ºöÊää/etc/proxysql.cnf Âíådisk ‰∏≠ÈÖçÁΩÆËøõË°åÂêàÂπ∂„ÄÇÂ¶ÇÊûúÂÜ≤Á™ÅÈúÄË¶ÅÁî®Êà∑Âπ≤È¢Ñ„ÄÇdisk‰ºöË¶ÜÁõñconfig file„ÄÇ</li>
</ul>
<h2 id="ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ">ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ</h2>
<p>ÈÖçÁΩÆ‰∏ª‰ªéÂàÜÁªÑ‰ø°ÊÅØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ProxySQL-Admin&gt;  show create table mysql_replication_hostgroups\G;
</span></span><span class="line"><span class="cl">*************************** 1. row ***************************
</span></span><span class="line"><span class="cl">       table: mysql_replication_hostgroups
</span></span><span class="line"><span class="cl">Create Table: CREATE TABLE mysql_replication_hostgroups (
</span></span><span class="line"><span class="cl">    writer_hostgroup INT CHECK (writer_hostgroup&gt;=0) NOT NULL PRIMARY KEY,
</span></span><span class="line"><span class="cl">    reader_hostgroup INT NOT NULL CHECK (reader_hostgroup&lt;&gt;writer_hostgroup AND reader_hostgroup&gt;=0),
</span></span><span class="line"><span class="cl">    check_type VARCHAR CHECK (LOWER(check_type) IN (&#39;read_only&#39;,&#39;innodb_read_only&#39;,&#39;super_read_only&#39;,&#39;read_only|innodb_read_only&#39;,&#39;read_only&amp;innodb_read_only&#39;)) NOT NULL DEFAULT &#39;read_only&#39;,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;, UNIQUE (reader_hostgroup))
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàÂàõÂª∫ÂÜôÁªÑÂíåËØªÁªÑ</p>
<p><code>insert ``into</code> <code>mysql_replication_hostgroups ( writer_hostgroup, reader_hostgroup, comment) values (10,20,``'proxy'``);</code></p>
<p>Á°Æ‰øùÊ≠§ÈÖçÁΩÆÂùáÂ∑≤ÂÜôÂÖ•‰∏âÁßçÈÖçÁΩÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">main</span><span class="o">.</span><span class="n">mysql_replication_hostgroups</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">writer_hostgroup</span> <span class="o">|</span> <span class="n">reader_hostgroup</span> <span class="o">|</span> <span class="n">check_type</span> <span class="o">|</span> <span class="n">comment</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">10</span>               <span class="o">|</span> <span class="mi">20</span>               <span class="o">|</span> <span class="n">read_only</span>  <span class="o">|</span> <span class="n">proxy</span>   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">main</span><span class="o">.</span><span class="n">runtime_mysql_replication_hostgroups</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Empty</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="nb">load</span> <span class="n">mysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">main</span><span class="o">.</span><span class="n">runtime_mysql_replication_hostgroups</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">writer_hostgroup</span> <span class="o">|</span> <span class="n">reader_hostgroup</span> <span class="o">|</span> <span class="n">check_type</span> <span class="o">|</span> <span class="n">comment</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">10</span>               <span class="o">|</span> <span class="mi">20</span>               <span class="o">|</span> <span class="n">read_only</span>  <span class="o">|</span> <span class="n">proxy</span>   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">use</span> <span class="n">disk</span>
</span></span><span class="line"><span class="cl"><span class="n">Reading</span> <span class="n">table</span> <span class="n">information</span> <span class="k">for</span> <span class="n">completion</span> <span class="n">of</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">column</span> <span class="n">names</span>
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="n">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="n">with</span> <span class="o">-</span><span class="n">A</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Database</span> <span class="n">changed</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">disk</span><span class="o">.</span><span class="n">mysql_replication_hostgroups</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Empty</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">save</span> <span class="n">mysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">disk</span>
</span></span><span class="line"><span class="cl">    <span class="o">-&gt;</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.02</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">disk</span><span class="o">.</span><span class="n">mysql_replication_hostgroups</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">writer_hostgroup</span> <span class="o">|</span> <span class="n">reader_hostgroup</span> <span class="o">|</span> <span class="n">check_type</span> <span class="o">|</span> <span class="n">comment</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="mi">10</span>               <span class="o">|</span> <span class="mi">20</span>               <span class="o">|</span> <span class="n">read_only</span>  <span class="o">|</span> <span class="n">proxy</span>   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------+------------------+------------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ProxySQL ‰ºöÊ†πÊçÆserver ÁöÑread _only ÁöÑÂèñÂÄºÂ∞ÜÊúçÂä°Âô®ËøõË°åÂàÜÁªÑ„ÄÇ read_only=0 ÁöÑserverÔºåmasterË¢´ÂàÜÂà∞ÁºñÂè∑‰∏∫10ÁöÑÂÜôÁªÑÔºåread_only=1 ÁöÑserverÔºåslaveÂàôË¢´ÂàÜÂà∞ÁºñÂè∑20ÁöÑËØªÁªÑ</strong></p>
<h2 id="Â∞Ü‰∏™ÊúçÂä°Âô®Ê∑ªÂä†Âà∞mysql_serverË°®">Â∞Ü‰∏™ÊúçÂä°Âô®Ê∑ªÂä†Âà∞mysql_serverË°®</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ProxySQL-Admin&gt;  show create table mysql_servers\G;
</span></span><span class="line"><span class="cl">*************************** 1. row ***************************
</span></span><span class="line"><span class="cl">       table: mysql_servers
</span></span><span class="line"><span class="cl">Create Table: CREATE TABLE mysql_servers (
</span></span><span class="line"><span class="cl">    hostgroup_id INT CHECK (hostgroup_id&gt;=0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT CHECK (port &gt;= 0 AND port &lt;= 65535) NOT NULL DEFAULT 3306,
</span></span><span class="line"><span class="cl">    gtid_port INT CHECK ((gtid_port &lt;&gt; port OR gtid_port=0) AND gtid_port &gt;= 0 AND gtid_port &lt;= 65535) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    status VARCHAR CHECK (UPPER(status) IN (&#39;ONLINE&#39;,&#39;SHUNNED&#39;,&#39;OFFLINE_SOFT&#39;, &#39;OFFLINE_HARD&#39;)) NOT NULL DEFAULT &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0 AND weight &lt;=10000000) NOT NULL DEFAULT 1,
</span></span><span class="line"><span class="cl">    compression INT CHECK (compression IN(0,1)) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    max_connections INT CHECK (max_connections &gt;=0) NOT NULL DEFAULT 1000,
</span></span><span class="line"><span class="cl">    max_replication_lag INT CHECK (max_replication_lag &gt;= 0 AND max_replication_lag &lt;= 126144000) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    use_ssl INT CHECK (use_ssl IN(0,1)) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    max_latency_ms INT UNSIGNED CHECK (max_latency_ms&gt;=0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostgroup_id, hostname, port) )
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR: 
</span></span><span class="line"><span class="cl">No query specified
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩøÁî®‰∏ãÈù¢ÁöÑËØ≠Âè•‰æùÊ¨°ÊèíÂÖ•Êàë‰ª¨ÂàöÂàöÊê≠Âª∫Â•ΩÁöÑÁöÑÊú∫Âô®ÔºàÊ≥®ÊÑèÂÜôÂÖ•ÁªÑËøòÊòØËØªÂèñÁªÑÁöÑÂå∫ÂàÜÔºâ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">insert into mysql_servers(hostgroup_id,hostname,port,comment) values (10,&#39;xxx.xxx.xxx.xxx&#39;,3306,&#34;ËØ¥Êòé&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Â∞Ü‰ø°ÊÅØÂêåÊ≠•Âà∞runtimeÂíådisk</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="nb">load</span> <span class="n">mysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">save</span> <span class="n">mysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ªË¶ÅÈÄöËøá‰∏ãÈù¢‰∏âÂè•ËØùÁ≤æÈÄâÈ™åËØÅ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> select * from disk.mysql_servers;
</span></span><span class="line"><span class="cl"> select * from runtime_mysql_servers;
</span></span><span class="line"><span class="cl"> select * from main.mysql_servers;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèËßÇÂØü<code> select * from mysql_servers;</code>Êó∂<code>status</code>ÂàóÂÖ®‰∏∫<code>ONLINE</code>Âç≥ÂèØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> +--------------+-----------------+------+-----------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------------------------+
</span></span><span class="line"><span class="cl">| hostgroup_id | hostname        | port | gtid_port | status | weight | compression | max_connections | max_replication_lag | use_ssl | max_latency_ms | comment                   |
</span></span><span class="line"><span class="cl">+--------------+-----------------+------+-----------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------------------------+
</span></span><span class="line"><span class="cl">| 10           | xxx.xxx.xxx.114 | 3306 | 0         | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              | Á¨¨‰∏ÄÊ¨°ÊµãËØïÁöÑ‰∏ªÊú∫          |
</span></span><span class="line"><span class="cl">| 20           | xxx.xxx.xxx.118 | 3306 | 0         | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              | Á¨¨‰∏ÄÊ¨°ÊµãËØïÁöÑ‰ªéÊú∫1         |
</span></span><span class="line"><span class="cl">| 20           | xxx.xxx.xxx.115 | 3306 | 0         | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              | Á¨¨‰∏ÄÊ¨°ÊµãËØïÁöÑ‰ªéÊú∫2         |
</span></span><span class="line"><span class="cl">+--------------+-----------------+------+-----------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------------------------+
</span></span><span class="line"><span class="cl">3 rows in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="proxysql-ÁõëÊéßÂêéÁ´ØËäÇÁÇπ">ProxySQL ÁõëÊéßÂêéÁ´ØËäÇÁÇπ</h2>
<p>‰∏∫ ProxySQL ÈÖçÁΩÆÁõëÊéßË¥¶Âè∑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">mysql</span><span class="o">-</span><span class="n">monitor_username</span><span class="o">=</span><span class="s1">&#39;monitor&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">mysql</span><span class="o">-</span><span class="n">monitor_password</span><span class="o">=</span><span class="s1">&#39;Mm-123456&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="nb">load</span> <span class="n">mysql</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">save</span> <span class="n">mysql</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">136</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú® mysql‰∏ª‰ªé ÁöÑmasterËäÇÁÇπËøõË°åËÆæÁΩÆË¥¶Âè∑ÂØÜÁ†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql&gt; create user &#39;monitor&#39;@&#39;%&#39; identified by &#39;Mm-123456&#39;;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; grant all privileges on *.* to &#39;monitor&#39;@&#39;%&#39;;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>È™åËØÅÁõëÊéß‰ø°ÊÅØÔºåProxySQL ÁõëÊéßÊ®°ÂùóÁöÑÊåáÊ†áÈÉΩ‰øùÂ≠òÂú®<code>monitorÂ∫ìÁöÑlogË°®‰∏≠</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ËøûÊé•Ôºöselect * from monitor.mysql_server_connect_log;
</span></span><span class="line"><span class="cl">Á®çÁ≠â‰∏Ä‰ºö ÁªìÊûúÂá∫Áé∞ connect_error ÂàóÂá∫Áé∞ NULL Âç≥ÂèØ
</span></span><span class="line"><span class="cl">ÂøÉË∑≥Ê£ÄÊµãpingÔºöselect * from mysql_server_ping_log limit 10;
</span></span><span class="line"><span class="cl">readonly:select * from mysql_server_read_only_log limit 10;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ÈÖçÁΩÆproxy">ÈÖçÁΩÆproxy</h2>
<p>SQL ËØ∑Ê±ÇÊâÄ‰ΩøÁî®ÁöÑÁî®Êà∑ÈÖçÁΩÆÔºåÈÉΩÈúÄË¶ÅÂÜçMysqlËäÇÁÇπÂàõÂª∫‰∏ä„ÄÇ</p>
<p>‚Äã	ÂàõÂª∫proxysql ÂØπÂ§ñËÆøÈóÆÁöÑË¥¶Êà∑(master)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql&gt; create user &#39;proxysql&#39;@&#39;ËøôÈáåÊòØproxyÁöÑip&#39; identified by &#39;Proxy-123456&#39;;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.01 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; grant all privileges on *.* to &#39;proxysql&#39;@&#39;ËøôÈáåÊòØproxyÁöÑip&#39; with grant option;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; flush privileges;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.01 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ProxySQL‰∏≠ÈúÄË¶ÅËÆæÁΩÆÁöÑË°®ÊòØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ProxySQL-Admin&gt;  show create table mysql_users\G;
</span></span><span class="line"><span class="cl">*************************** 1. row ***************************
</span></span><span class="line"><span class="cl">       table: mysql_users
</span></span><span class="line"><span class="cl">Create Table: CREATE TABLE mysql_users (
</span></span><span class="line"><span class="cl">    username VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    password VARCHAR,
</span></span><span class="line"><span class="cl">    active INT CHECK (active IN (0,1)) NOT NULL DEFAULT 1,
</span></span><span class="line"><span class="cl">    use_ssl INT CHECK (use_ssl IN (0,1)) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    default_hostgroup INT NOT NULL DEFAULT 0,  #ÈªòËÆ§Ë∑ØÁî±ÁõÆÊ†á
</span></span><span class="line"><span class="cl">    default_schema VARCHAR,
</span></span><span class="line"><span class="cl">    schema_locked INT CHECK (schema_locked IN (0,1)) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    transaction_persistent INT CHECK (transaction_persistent IN (0,1)) NOT NULL DEFAULT 1,
</span></span><span class="line"><span class="cl">    fast_forward INT CHECK (fast_forward IN (0,1)) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    backend INT CHECK (backend IN (0,1)) NOT NULL DEFAULT 1,
</span></span><span class="line"><span class="cl">    frontend INT CHECK (frontend IN (0,1)) NOT NULL DEFAULT 1,
</span></span><span class="line"><span class="cl">    max_connections INT CHECK (max_connections &gt;=0) NOT NULL DEFAULT 10000,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (username, backend),
</span></span><span class="line"><span class="cl">    UNIQUE (username, frontend))
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR: 
</span></span><span class="line"><span class="cl">No query specified
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Â∞ÜÂú®<code>master</code>‰∏äËÆæÁΩÆÁî®‰∫é<code>proxy</code>ËÆøÈóÆÁöÑË¥¶Êà∑ÊèíÂÖ•Âà∞<code>ProxySql</code>ÁöÑ<code>mysql_users</code>Ë°®‰∏≠</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">insert</span> <span class="n">into</span> <span class="n">mysql_users</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">default_hostgroup</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="s1">&#39;proxysql&#39;</span><span class="p">,</span><span class="s1">&#39;Proxy-123456&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="nb">load</span> <span class="n">mysql</span> <span class="n">users</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">save</span> <span class="n">mysql</span> <span class="n">users</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ProxySQL-Admin&gt;  select * from mysql_users\G;
</span></span><span class="line"><span class="cl">*************************** 1. row ***************************
</span></span><span class="line"><span class="cl">              username: proxysql
</span></span><span class="line"><span class="cl">              password: Proxy-123456
</span></span><span class="line"><span class="cl">                active: 1
</span></span><span class="line"><span class="cl">               use_ssl: 0
</span></span><span class="line"><span class="cl">     default_hostgroup: 10
</span></span><span class="line"><span class="cl">        default_schema: NULL
</span></span><span class="line"><span class="cl">         schema_locked: 0
</span></span><span class="line"><span class="cl">transaction_persistent: 1
</span></span><span class="line"><span class="cl">          fast_forward: 0
</span></span><span class="line"><span class="cl">               backend: 1
</span></span><span class="line"><span class="cl">              frontend: 1
</span></span><span class="line"><span class="cl">       max_connections: 10000
</span></span><span class="line"><span class="cl">               comment: 
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR: 
</span></span><span class="line"><span class="cl">No query specified
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂ÂèØ‰ª•Âú®ÊúâÊùÉÈôêÁôªÂΩïÁöÑÊú∫Âô®Áî®proxysqlË¥¶Êà∑ÁôªÂΩïÂàõÂª∫Â∫ìË∞ÉËØïÁúãÁúã„ÄÇ</p>
<p>ÂøòËÆ∞Ëá™Â∑±ÁôªÂΩïÂà∞ÈÇ£‰∏™ÊúçÂä°ÂèØ‰ª•Áî®<code> select @@server_id;</code>Êü•ÁúãÊâÄÂú®Êú∫Âô®„ÄÇ</p>
<h3 id="ÈÖçÁΩÆËØªÂÜôÂàÜÁ¶ª">ÈÖçÁΩÆËØªÂÜôÂàÜÁ¶ª</h3>
<h4 id="Ë∑ØÁî±ËßÑÂàô">Ë∑ØÁî±ËßÑÂàô</h4>
<p>Ë∑ØÁî±ËßÑÂàôÈÖçÁΩÆÈùûÂ∏∏ÁÅµÊ¥ªÔºåÂèØ‰ª•Âü∫‰∫éschemaÔºå‰πüÂèØ‰ª•Âü∫‰∫éÁî®Êà∑ÔºåÊàñÂçï‰∏™sqlËØ≠Âè•ÂÆûÁé∞Ë∑ØÁî±ÂÆöÂà∂„ÄÇ</p>
<p>„Äê<strong>ÂÆûÈôÖËøáÁ®ã‰∏≠Â∫îËØ•‰ªéÊâãÊú∫ÁöÑÊÖ¢Êó•ÂøóÂêÑÈ°πÊåáÊ†á‰∏≠ÊâæÂá∫ÂéãÂäõÂ§ßÔºåÊâßË°åÈ¢ëÁπÅÁöÑËØ≠Âè•ÂçïÁã¨ÂÜôË∑ØÁî±ËßÑÂàôÂíåÁºìÂ≠òÔºåÂª∫ËÆÆ‰ΩøÁî®hash code ÂÄºÂÅöËØªÂÜôÁ∫πÁêÜÔºå‰∏çË¶ÅÂª∫Â§™Â§öËßÑÂàô</strong>„Äë</p>
<p>mysql_query_rules_fast_routingÊòØmysql_query_rules</p>
<p>‰ªãÁªç‰∏Ä‰∏ãÊîπË°®mysql_query_rulesÁöÑÂá†‰∏™Â≠óÊÆµÔºö
<code>active</code>ÔºöÊòØÂê¶ÂêØÁî®Ëøô‰∏™ËßÑÂàôÔºå1Ë°®Á§∫ÂêØÁî®Ôºå0Ë°®Á§∫Á¶ÅÁî®
<code>match_pattern</code> Â≠óÊÆµÂ∞±ÊòØ‰ª£Ë°®ËÆæÁΩÆËßÑÂàô
<code>destination_hostgroup</code> Â≠óÊÆµ‰ª£Ë°®ÈªòËÆ§ÊåáÂÆöÁöÑÂàÜÁªÑÔºå
<code>apply</code> ‰ª£Ë°®ÁúüÊ≠£ÊâßË°åÂ∫îÁî®ËßÑÂàô„ÄÇ</p>
<h4 id="ËßÑÂàôÁöÑÂÜôÂÖ•">ËßÑÂàôÁöÑÂÜôÂÖ•</h4>
<p>ProxySQL ÊòØÊ†πÊçÆ<code>rule_id</code>ÁöÑÈ°∫Â∫èÊù•ËøõË°åËßÑÂàôÂåπÈÖçÁöÑÊ≥®ÊÑèËßÑÂàôÁöÑÁºñÂÜôÈ°∫Â∫è</p>
<p>ÊâÄÊúâ‰ª•select ÂºÄÂ§¥ÁöÑËØ≠Âè•ÂÖ®ÈÉ®ÂàÜÈÖçÂà∞ËØªÁªÑ‰∏≠Ôºå‰∏äÈù¢Âª∫Á´ãËØªÁªÑÁºñÂè∑ÊòØ20</p>
<p><code>insert into mysql_query_rules(rule_id,active,match_pattern,destination_hostgroup,apply) values (2,1,'^select',20,1);</code></p>
<p>ËØ¥Êúâ‰ª•insertÂºÄÂ§¥ÁöÑËØ≠Âè•ÂÖ®ÈÉ®ÂàÜÈÖçÂà∞ÂÜôÁªÑ‰∏≠</p>
<p><code>insert into mysql_query_rules(rule_id,active,match_pattern,destination_hostgroup,apply) values (1,1,'^SELECT.*FOR UPDATE$',10,1);</code></p>
<p><code>insert into mysql_query_rules(rule_id,active,match_pattern,destination_hostgroup,apply) values (3,1,'^insert',10,1);</code></p>
<p>Ê≥®ÊÑèË¶Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="nb">load</span> <span class="n">mysql</span> <span class="n">query</span> <span class="n">rules</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">save</span> <span class="n">mysql</span> <span class="n">query</span> <span class="n">rules</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ËØªÂÜôÂàÜÁ¶ªÊµãËØï">ËØªÂÜôÂàÜÁ¶ªÊµãËØï</h4>
<p>Âú®ProxySQLÁöÑ‰∏ªÊú∫‰∏äËøêË°å</p>
<h5 id="ÊµãËØïËØª">ÊµãËØïËØª</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql -uproxysql -pProxy-123456 -h 127.0.0.1 -P 6033 -e &#34;select @@server_id&#34;;
</span></span><span class="line"><span class="cl">ÂèØ‰ª•ËøîÂõûÊ≠£Á°ÆÁöÑserver_idÂç≥ÂèØÔºåÂõ†‰∏∫ÊàëÁöÑÂêéÂè∞ÊòØ‰ø©Âè∞Âè™ËØªÊú∫Âô®ÔºåÊâÄ‰ª•‰ºö‰∫§ÊõøÂá∫Áé∞ËÆøÈóÆ‰ø©Âè∞Êú∫Âô®ÁöÑserver_id;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; select @@server_id for update;  Ê≠§ËØ≠Âè•SELECT...FOR UPDATE ‰ºöÁî≥ËØ∑ÂÜôÈîÅÔºåÊâÄ‰ª•Áî®Âú®ËøôÈáåÊØîËæÉÂêàÈÄÇ„ÄÇ
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">| @@server_id |
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">|         114 |
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÊµãËØïÂÜô">ÊµãËØïÂÜô</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql -uproxysql -pProxy-123456 -h 127.0.0.1 -P 6033 ÁôªÂΩïÂêé
</span></span><span class="line"><span class="cl">mysql&gt; begin;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; insert into hanzhongtest.edu_user values(9,&#34;ÊµãËØïÂÜô3&#34;,&#34;wahah&#34;);
</span></span><span class="line"><span class="cl">Query OK, 1 row affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; select @@server_id;
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">| @@server_id |
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">|         114 |
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; commit;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Êü•ÁúãË∑ØÁî±‰ø°ÊÅØ">Êü•ÁúãË∑ØÁî±‰ø°ÊÅØ</h4>
<p>‰ΩøÁî®adminË¥¶Âè∑ÁôªÂΩïProxySQL</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost proxysql]# mysql -u admin -padmin -h 127.0.0.1 -P 6032 --prompt=&#39;ProxySQL-Admin&gt;  &#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ProxySQL-Admin&gt;  SELECT hostgroup hg,
</span></span><span class="line"><span class="cl">    -&gt;               sum_time,
</span></span><span class="line"><span class="cl">    -&gt;               count_star,
</span></span><span class="line"><span class="cl">    -&gt;               digest_text 
</span></span><span class="line"><span class="cl">    -&gt;        FROM stats_mysql_query_digest
</span></span><span class="line"><span class="cl">    -&gt;        ORDER BY sum_time DESC;
</span></span><span class="line"><span class="cl">+----+----------+------------+-------------------------------------------------------+
</span></span><span class="line"><span class="cl">| hg | sum_time | count_star | digest_text                                           |
</span></span><span class="line"><span class="cl">+----+----------+------------+-------------------------------------------------------+
</span></span><span class="line"><span class="cl">| 20 | 83455    | 70         | select @@server_id                                    |
</span></span><span class="line"><span class="cl">| 10 | 4383     | 2          | commit                                                |
</span></span><span class="line"><span class="cl">| 10 | 1275     | 2          | insert into hanzhongtest.edu_user values(?,?,?)       |
</span></span><span class="line"><span class="cl">| 10 | 1205     | 1          | start transantion                                     |
</span></span><span class="line"><span class="cl">| 20 | 1015     | 1          | select * from stats_mysql_query_digest                |
</span></span><span class="line"><span class="cl">| 10 | 798      | 2          | begin insert into hanzhongtest.edu_user values(?,?,?) |
</span></span><span class="line"><span class="cl">| 10 | 792      | 2          | begin                                                 |
</span></span><span class="line"><span class="cl">| 10 | 454      | 1          | select @@server_id                                    |
</span></span><span class="line"><span class="cl">| 10 | 0        | 71         | select @@version_comment limit ?                      |
</span></span><span class="line"><span class="cl">+----+----------+------------+-------------------------------------------------------+
</span></span><span class="line"><span class="cl">9 rows in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÊÄªÁªì">ÊÄªÁªìÔºö</h3>
<p>Ë∑ØÁî±ËßÑÂàôÊØîËæÉÁÅµÊ¥ªÈúÄË¶ÅÂ§öÁúã<a class="link" href="https://github.com/sysown/proxysql/wiki"  target="_blank" rel="noopener"
    >ÂÆòÊñπÊñáÊ°£</a></p>
<p>Âà©Áî®ProxySQLËØªÂÜôÂàÜÁ¶ªÂèØ‰ª•Èôç‰Ωé‰∏ªÂ∫ìÁöÑÂéãÂäõÔºå‰ΩÜÊòØÂΩì‰∏ªÂ∫ìÂÆïÊú∫ÂêéÈõÜÁæ§Â∞Ü‰∏çËÉΩÂÜçÂÜô„ÄÇÊâÄ‰ª•ÈúÄË¶Åreplication managerÂÆûÁé∞È´òÂèØÁî®ÁöÑÂçèÂä©„ÄÇ</p>
<p>ÂÖ∂Ê¨°ÈúÄË¶ÅÂÆûÈ™åÂØπ‰∫é<code>mysql galera cluster</code>ÁöÑËØªÂÜôÂàÜÁ¶ªÂíåË¥üËΩΩ„ÄÇ</p>
<h4 id="ÈÅáÂà∞ÁöÑÈóÆÈ¢ò">ÈÅáÂà∞ÁöÑÈóÆÈ¢ò</h4>
<p>1.Âª∫Á´ãË¥¶Êà∑ÊòØËÆøÈóÆIPÂ∫îÊòéÁ°Æ</p>
<p>2.firewalld ÂÆûÈ™åÁöÑÊó∂ÂÄôË¶Å‰∏çÂÖ≥ÊéâÔºåË¶Å‰∏çÂÜôËßÑÂàôÂºÄÊîæÁ´ØÂè£„ÄÇ</p>
<h2 id="proxysql-ÁöÑÈ´òÂèØÁî®">ProxySql ÁöÑÈ´òÂèØÁî®</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ÁºñÂÜô‰∫∫</th>
<th>ÁºñÂÜôÊó∂Èó¥</th>
<th>ÁºñÂÜôËØ¥Êòé</th>
</tr>
</thead>
<tbody>
<tr>
<td>Á´†ÁÄö‰∏≠</td>
<td>2020-9-12</td>
<td>Êé•‰∏ä‰∏ÄÁØá[proxysql ËØªÂÜôÂàÜÁ¶ª](<a class="link" href="http://wiki-private.capitalonline.net:8090/pages/viewpage.action?pageId=59474862"  target="_blank" rel="noopener"
    >ProxySQL ËØªÂÜôÂàÜÁ¶ª</a>)‰∏ÄËµ∑ËßÇÁúãËæÉ‰Ω≥</td>
</tr>
</tbody>
</table></div>
<p>Êúâ‰∏§‰∏™ÁªÑ‰ª∂ÂÆûÁé∞‰∫ÜProxySQLÈõÜÁæ§</p>
<ul>
<li>
<p><strong>monitoring(ÈõÜÁæ§ÁõëÊéßÁªÑ‰ª∂)</strong></p>
</li>
<li>
<p><strong>re-configuration(ËøúÁ®ãÈÖçÁΩÆ)</strong></p>
<p>‰ø©ÁªÑ‰ª∂ÈÉΩÊúâ4Âº†Ë°®</p>
<p><strong>-</strong> mysql_query_rules
<strong>-</strong> mysql_servers
<strong>-</strong> mysql_users
<strong>-</strong> proxysql_servers</p>
</li>
</ul>
<h3 id="Áõ∏ÂÖ≥ÂèòÈáè">Áõ∏ÂÖ≥ÂèòÈáè</h3>
<p>Admin variables Ôºö‰ΩøÁî®<code>load admin variables to runtime</code>‰ΩøÂÖ∂ÁîüÊïà</p>
<h4 id="1Áî®‰∫éÂêåÊ≠•ÁöÑÂèòÈáè">1.Áî®‰∫éÂêåÊ≠•ÁöÑÂèòÈáè</h4>
<pre><code>- `admin-checksum_mysql_query_rules` boolean ÂèòÈáèÔºåÈªòËÆ§tureÔºåÂΩì‰ΩøÁî®`load mysql query rules to runtime`Êó∂Ôºå‰ºöÁîüÊàêÊñ∞ÁöÑÈÖçÁΩÆÊ†°È™åÁ†Å„ÄÇÂ¶ÇÊûúÊòØfalse Êñ∞ÁöÑÈÖçÁΩÆ‰∏ç‰ºöËá™Âä®ÂπøÊí≠ÂíåÂêåÊ≠•ËøúÁ´ØÊï∞ÊçÆ„ÄÇ
- `admin-checksum_mysql_servers` Â∏ÉÂ∞îÁ±ªÂûãÔºåÈªòËÆ§ture `load mysql servers to runtime` Âêå‰∏ä
- `admin-chechsum_mysql_users`Â∏ÉÂ∞îÁ±ªÂûãÔºåÈªòËÆ§ture `load mysql users to runtime`,Âêå‰∏äÔºå‰ΩÜÊòØÁî®Êà∑ÊúâÊï∞Áôæ‰∏áÔºå‰∏∫‰∫Ü‰∏çÂΩ±ÂìçÊÄßËÉΩÂ∞±Ë¶ÅËÆæÁΩÆ‰∏∫false„ÄÇ
</code></pre>
<h4 id="2ÈõÜÁæ§Âá≠ËØÅÂèòÈáè">2.ÈõÜÁæ§Âá≠ËØÅÂèòÈáè</h4>
<ul>
<li><code>admin-cluster_username</code></li>
<li><code>admin-cluser_password</code></li>
</ul>
<p>ËøôÊòØÁî®‰∫éÁõëÊéßÂÖ∂‰ªñProxySQLÂÆû‰æã ÔºåËøô‰ø©‰∏™ÂèòÈáèÈúÄË¶ÅÂÜç<code>admin-admin_credentials</code>‰∏≠Â≠òÂú®„ÄÇ</p>
<h4 id="3Ê£ÄÊü•È¢ëÁéáÂíåÈó¥ÈöîÊó∂Èó¥">3.Ê£ÄÊü•È¢ëÁéáÂíåÈó¥ÈöîÊó∂Èó¥</h4>
<ul>
<li><code>admin-cluster_check_interval_ms</code>Ëøô‰∏™ÂèòÈáèÂÆö‰πâ‰∫ÜÊ£ÄÊü•chechsumsÁöÑÊó∂Èó¥ÔºåÈªòËÆ§1000,ÊúÄÂ∞è10ÔºåÊúÄÂ§ß 300000.</li>
<li><code>admin-cluster_check_status_frequency</code>ÂÆö‰πâ‰∫ÜÂ§öÂ∞ëÊ¨°checksumsÊ£ÄÊü•Â∞±È™åËØÅ‰∏ÄÊ¨°ËøûÊé•ÊÄß„ÄÇ</li>
</ul>
<h4 id="4Â∞ÜÈÖçÁΩÆÂêåÊ≠•Âà∞Á£ÅÁõò">4.Â∞ÜÈÖçÁΩÆÂêåÊ≠•Âà∞Á£ÅÁõò</h4>
<p>Âú®ËøúÁ®ãÂêåÊ≠•ÈÖçÁΩÆ‰πãÂêéÔºåÈÄöÂ∏∏ÊúÄÂ•ΩÁöÑÂÅöÊ≥ïÊòØÁ´ãÂç≥Â∞ÜÊñ∞ÁöÑÊõ¥Êîπ‰øùÂ≠òÂà∞Á£ÅÁõò„ÄÇËøôÊ†∑ÈáçÂêØÊó∂ÔºåÊõ¥ÊîπÁöÑÈÖçÁΩÆ‰∏ç‰ºö‰∏¢Â§±„ÄÇ
<strong>-</strong> <code>admin-cluster_mysql_query_rules_save_to_disk</code>
<strong>-</strong> <code>admin-cluster_mysql_servers_save_to_disk</code>
<strong>-</strong> <code>admin-cluster_mysql_users_save_to_disk</code>
<strong>-</strong> <code>admin-cluster_proxysql_servers_save_to_disk</code></p>
<p>ËøôÂá†‰∏™ÂèòÈáèÈÉΩÊòØÂ∏ÉÂ∞îÂÄº„ÄÇÂΩìËÆæÁΩÆ‰∏∫true(ÈªòËÆ§ÂÄº)Êó∂ÔºåÂú®ËøúÁ®ãÂêåÊ≠•Âπ∂loadÂà∞runtimeÂêéÔºåÊñ∞ÁöÑmysql_query_rules„ÄÅmysql_servers„ÄÅmysql_users„ÄÅproxysql_serversÈÖçÁΩÆ‰ºöÊåÅ‰πÖÂåñÂà∞Á£ÅÁõò‰∏≠„ÄÇ</p>
<h4 id="5ÊòØÂê¶ÈúÄË¶ÅËøúÁ®ãÂêåÊ≠•ÂèòÈáè">5.ÊòØÂê¶ÈúÄË¶ÅËøúÁ®ãÂêåÊ≠•ÂèòÈáè</h4>
<p>Áî±‰∫éÊüê‰∫õÂéüÂõ†ÔºåÂèØËÉΩÂ§ö‰∏™ProxySQLÂÆû‰æã‰ºöÂú®Âêå‰∏ÄÊó∂Èó¥ËøõË°åÈáçÊñ∞ÈÖçÁΩÆ„ÄÇ
‰æãÂ¶ÇÔºåÊØè‰∏™ProxySQLÂÆû‰æãÈÉΩÂú®ÁõëÊéßMySQLÁöÑreplicationÔºå‰∏îËá™Âä®Êé¢ÊµãÂà∞MySQLÁöÑÊïÖÈöúËΩ¨ÁßªÔºåÂú®‰∏Ä‰∏™ÊûÅÁü≠ÁöÑÊó∂Èó¥ÂÜÖ(ÂèØËÉΩÂ∞è‰∫é1Áßí)ÔºåËøô‰∫õProxySQLÂÆû‰æãÂèØËÉΩ‰ºöËá™Âä®Ë∞ÉÊï¥Êñ∞ÁöÑÈÖçÁΩÆÔºåËÄåÊó†ÈúÄÈÄöËøáÂÖ∂ÂÆÉProxySQLÂÆû‰æãÊù•ÂêåÊ≠•Êñ∞ÈÖçÁΩÆ„ÄÇ</p>
<p>Á±ª‰ººÁöÑËøòÊúâÔºåÂΩìÊâÄÊúâProxySQLÂÆû‰æãÈÉΩÊé¢ÊµãÂà∞‰∫ÜÂíåÊüêÂÆû‰æãÁöÑ‰∏¥Êó∂ÁöÑÁΩëÁªúÈóÆÈ¢òÔºåÊàñËÄÖÊüê‰∏™MySQLËäÇÁÇπÊØîËæÉÊÖ¢(replication lag,  ÊãñÂêéËÖø)ÔºåËøô‰∫õProxySQLÂÆû‰æãÈÉΩ‰ºöËá™Âä®Âú∞ÈÅøÂºÄËøô‰∫õËäÇÁÇπ„ÄÇËøôÊó∂ÂêÑProxySQLÂÆû‰æã‰πüÊó†ÈúÄ‰ªéÂÖ∂ÂÆÉËäÇÁÇπÂ§ÑÂêåÊ≠•ÈÖçÁΩÆÔºåËÄåÊòØÂêåÊó∂Ëá™Âä®ÂÆåÊàêÊñ∞ÁöÑÈÖçÁΩÆ„ÄÇ</p>
<p>ÈÖçÁΩÆProxySQLÈõÜÁæ§ÔºåËÆ©ÂêÑProxySQLÂÆû‰æãÊöÇÊó∂Êó†ÈúÄ‰ªéÂÖ∂ÂÆÉÂÆû‰æãÂ§ÑÂêåÊ≠•Êüê‰∫õÈÖçÁΩÆÔºåËÄåÊòØÁ≠âÂæÖ‰∏ÄÂÆöÊ¨°Êï∞ÁöÑÊ£ÄÊü•‰πãÂêéÔºåÂÜçËß¶ÂèëËøúÁ®ãÂêåÊ≠•„ÄÇ‰ΩÜÊòØÔºåÂ¶ÇÊûúÊú¨Âú∞ÂíåËøúÁ®ãËäÇÁÇπÁöÑËøô‰∫õÂèòÈáèÈòàÂÄº‰∏çÂêåÔºåÂàôËøòÊòØ‰ºöËß¶ÂèëËøúÁ®ãÂêåÊ≠•„ÄÇ</p>
<p><strong>-</strong> <code>admin-cluster_mysql_query_rules_diffs_before_sync</code>
<strong>-</strong> <code>admin-cluster_mysql_servers_diffs_before_sync</code>
<strong>-</strong> <code>admin-cluster_mysql_users_diffs_before_sync</code>
<strong>-</strong> <code>admin-cluster_proxysql_servers_diffs_before_sync</code></p>
<p>ÂàÜÂà´ÂÆö‰πâÁªèËøáÂ§öÂ∞ëÊ¨°ÁöÑ&quot;Êó†Ê≥ïÂåπÈÖç&quot;Ê£ÄÊü•‰πãÂêéÔºåËß¶Âèëmysql_query_rules„ÄÅmysql_servers„ÄÅmysql_users„ÄÅproxysql_serversÈÖçÁΩÆÁöÑËøúÁ®ãÂêåÊ≠•„ÄÇÈªòËÆ§ÂÄº3Ê¨°ÔºåÊúÄÂ∞èÂÄº0ÔºåË°®Á§∫Ê∞∏‰∏çËøúÁ®ãÂêåÊ≠•ÔºåÊúÄÂ§ßÂÄº1000„ÄÇ</p>
<p>ÊØîÂ¶ÇÂêÑÂÆû‰æãÁõëÊéßmysql_serversÈÖçÁΩÆÂπ∂ÂÅöÊ†°È™åÁ†ÅÊ£ÄÊü•ÔºåÂ¶ÇÊûúÊüêÂÆû‰æãÂíåÊú¨Âú∞ÈÖçÁΩÆ‰∏çÂêåÔºåÂΩìÂ§öÊ¨°Ê£ÄÊµãÂà∞ÈÉΩ‰∏çÂêåÊó∂ÔºåÂ∞ÜÊ†πÊçÆload to runtimeÁöÑÊó∂Èó¥Êà≥ÂÜ≥ÂÆöÊòØÂê¶Ë¶Å‰ªéËøúÁ´ØÂ∞Ümysql_serversÂêåÊ≠•Âà∞Êú¨Âú∞„ÄÇ</p>
<h4 id="6Âª∂ËøüÂêåÊ≠•">6.Âª∂ËøüÂêåÊ≠•</h4>
<p>ProxySQL Cluster ÂèØ‰ª•ÂÆö‰πâËææÂà∞Â§öÂ∞ë‰∏™checksum ‰∏çÂêå‰πãÂêéÔºåÊâçÂú®ÈõÜÁæ§ÂÜÖÈÉ®ËøõË°åÈÖçÁΩÆÂêåÊ≠•„ÄÇ
query rules, servers, users Âíåproxysql servers ÂàÜÂà´Êúâadmin-cluster_XXX_diffs_before_sync Áõ∏ÂÖ≥ÁöÑÂèÇÊï∞ÔºåÂèñÂÄºËåÉÂõ¥0 ÔΩû 1000Ôºå0 ‰ª£Ë°®‰ªé‰∏çÂêåÊ≠•„ÄÇÈªòËÆ§3„ÄÇ</p>
<h3 id="ÈúÄË¶ÅÈÖçÁΩÆÁöÑË°®">ÈúÄË¶ÅÈÖçÁΩÆÁöÑË°®</h3>
<h4 id="1proxysql_servers">1.proxysql_servers</h4>
<p>ÂÆö‰πâproxyssqlÈõÜÁæ§‰∏≠ÊúâÂì™‰∫õÂÆû‰æãÔºåÂèØ‰ª•Âú®Á∫øinsertÔºå‰πüÂèØ‰ª•‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ProxySQL-Admin&gt;  show create table proxysql_servers;
</span></span><span class="line"><span class="cl">+------------------+--------------------------
</span></span><span class="line"><span class="cl">| table            | Create Table            |
</span></span><span class="line"><span class="cl">+------------------+--------------------------
</span></span><span class="line"><span class="cl">| proxysql_servers | CREATE TABLE proxysql_servers (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port) ) |
</span></span><span class="line"><span class="cl">+------------------+--------------------------
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ProxySQLÂè™ÊúâÂú®Á£ÅÁõòÊï∞ÊçÆÂ∫ìÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåÊàñËÄÖ‰ΩøÁî®‰∫Ü&ndash;initialÈÄâÈ°πÊó∂Êâç‰ºöËØªÂèñ‰º†ÁªüÈÖçÁΩÆÊñá‰ª∂„ÄÇ</p>
<h4 id="2runtime_proxysql_servers">2.runtime_proxysql_servers</h4>
<p>Ê≠£Â¶ÇÂÖ∂ÂÆÉruntime_Ë°®‰∏ÄÊ†∑Ôºåruntime_proxysql_serversË°®Âíåproxysql_serversÁöÑÁªìÊûÑÂÆåÂÖ®‰∏ÄËá¥ÔºåÂè™‰∏çËøáÂÆÉÊòØruntimeÊï∞ÊçÆÁªìÊûÑ‰∏≠ÁöÑÈÖçÁΩÆÔºå‰πüÂ∞±ÊòØÂΩìÂâçÊ≠£Âú®ÁîüÊïàÁöÑÈÖçÁΩÆ„ÄÇËØ•Ë°®ÁöÑÂÆö‰πâËØ≠Âè•Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">| runtime_proxysql_servers | CREATE TABLE runtime_proxysql_servers (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port) ) |
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3runtime_checksums_values">3.runtime_checksums_values</h4>
<p>Ëøô‰∏™‰∏çÊòØÂü∫‰∫éÂÜÖÂ≠òÁöÑ„ÄÇÁî®‰∫é load to runtimeÊó∂ÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">| runtime_checksums_values | CREATE TABLE runtime_checksums_values (
</span></span><span class="line"><span class="cl">    name VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    version INT NOT NULL,
</span></span><span class="line"><span class="cl">    epoch INT NOT NULL,
</span></span><span class="line"><span class="cl">    checksum VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (name)) |
</span></span></code></pre></td></tr></table>
</div>
</div><p>- nameÔºöÊ®°ÂùóÁöÑÂêçÁß∞
- versionÔºöÊâßË°å‰∫ÜÂ§öÂ∞ëÊ¨°load to runtimeÊìç‰ΩúÔºåÂåÖÊã¨ÊâÄÊúâÈöêÂºèÂíåÊòæÂºèÊâßË°åÁöÑ(Êüê‰∫õ‰∫ã‰ª∂‰ºöÂØºËá¥ProxySQLÂÜÖÈÉ®Ëá™Âä®ÊâßË°åload to runtimeÂëΩ‰ª§)
- epochÔºöÊúÄËøë‰∏ÄÊ¨°ÊâßË°åload to runtimeÁöÑÊó∂Èó¥Êà≥
- checksumÔºöÊâßË°åload to runtimeÊó∂ÁîüÊàêÁöÑÈÖçÁΩÆÊ†°È™åÁ†Å(checksum)</p>
<p><strong>ÁâπÂà´Ê≥®ÊÑèÔºö</strong>  ÁõÆÂâç6‰∏™ÁªÑ‰ª∂‰∏≠Âè™Êúâ4ÁßçÊ®°ÂùóÁöÑÈÖçÁΩÆ‰ºöÁîüÊàêÂØπÂ∫îÁöÑÊ†°È™åÁ†Å(checksum)Ôºå‰∏çËÉΩÁîüÊàêÁöÑÁªÑ‰ª∂ÊòØÔºöadmin_variablesÔºåmysql_variables„ÄÇ checnsum Âè™ÊúâÂú®ÊâßË°å‰∫Üload to run ÔºåÂπ∂‰∏îadmin-checksum_XXX = true Êó∂ÔºåÊâçÂèØ‰ª•Ê≠£Â∏∏ÁîüÊàê„ÄÇÂç≥:
- LOAD MYSQL QUERY RULES TO RUNTIMEÔºöÂΩìadmin-checksum_mysql_query_rules=trueÊó∂ÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑmysql_query_rulesÈÖçÁΩÆÊ†°È™åÁ†Å
- LOAD MYSQL SERVERS TO RUNTIMEÔºöÂΩìadmin-checksum_mysql_servers=trueÊó∂ÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑmysql_serversÈÖçÁΩÆÊ†°È™åÁ†Å
- LOAD MYSQL USERS TO RUNTIMEÔºöÂΩìadmin-checksum_mysql_users=trueÊó∂ÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑmysql_usersÈÖçÁΩÆÊ†°È™åÁ†Å
- LOAD PROXYSQL SERVERS TO RUNTIMEÔºöÊÄªÊòØ‰ºöÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑproxysql_serversÈÖçÁΩÆÊ†°È™åÁ†Å
- LOAD ADMIN VARIABLES TO RUNTIMEÔºö‰∏çÁîüÊàêÊ†°È™åÁ†Å
- LOAD MYSQL VARIABLES TO RUNTIMEÔºö‰∏çÁîü‰∫ßÊ†°È™åÁ†Å</p>
<p><strong>New commands ÔºàÊñ∞ÂëΩ‰ª§Ôºâ:</strong>
- LOAD PROXYSQL SERVERS FROM MEMORY / LOAD PROXYSQL SERVERS TO RUNTIME
‰ªéÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì‰∏≠Âä†ËΩΩproxysql serversÈÖçÁΩÆÂà∞runtimeÊï∞ÊçÆÁªìÊûÑ
- SAVE PROXYSQL SERVERS TO MEMORY / SAVE PROXYSQL SERVERS FROM RUNTIME
Â∞Üproxysql serversÈÖçÁΩÆ‰ªéruntimeÊï∞ÊçÆÁªìÊûÑÊåÅ‰πÖÂåñ‰øùÂ≠òÂà∞ÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì‰∏≠
- LOAD PROXYSQL SERVERS TO MEMORY / LOAD PROXYSQL SERVERS FROM DISK
‰ªéÁ£ÅÁõòÊï∞ÊçÆÂ∫ì‰∏≠Âä†ËΩΩproxysql serversÈÖçÁΩÆÂà∞ÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì‰∏≠
- LOAD PROXYSQL SERVERS FROM CONFIG
‰ªé‰º†ÁªüÈÖçÁΩÆÊñá‰ª∂‰∏≠Âä†ËΩΩproxysql serversÈÖçÁΩÆÂà∞ÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì‰∏≠
- SAVE PROXYSQL SERVERS FROM MEMORY / SAVE PROXYSQL SERVERS TO DISK
Â∞Üproxysql serversÈÖçÁΩÆ‰ªéÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì‰∏≠ÊåÅ‰πÖÂåñ‰øùÂ≠òÂà∞Á£ÅÁõòÊï∞ÊçÆÂ∫ì‰∏≠</p>
<h3 id="stats-tables">stats tables</h3>
<h4 id="1stats_proxysql_servers_checksums">1.stats_proxysql_servers_checksums</h4>
<p>ËÆ∞ÂΩïÈõÜÁæ§‰∏≠ÂêÑ‰∏™ÂÆû‰æãÁöÑÁªÑ‰ª∂checksum ‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> show create table stats.stats_proxysql_servers_checksums;
</span></span><span class="line"><span class="cl">| stats_proxysql_servers_checksums | CREATE TABLE stats_proxysql_servers_checksums (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    name VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    version INT NOT NULL,
</span></span><span class="line"><span class="cl">    epoch INT NOT NULL,
</span></span><span class="line"><span class="cl">    checksum VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    changed_at INT NOT NULL,
</span></span><span class="line"><span class="cl">    updated_at INT NOT NULL,
</span></span><span class="line"><span class="cl">    diff_check INT NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port, name) ) |
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêÑÂ≠óÊÆµÊÑè‰πâÂ¶Ç‰∏ãÔºö
- hostnameÔºöProxySQLÂÆû‰æãÁöÑ‰∏ªÊú∫Âêç
- portÔºöProxySQLÂÆû‰æãÁöÑÁ´ØÂè£
- nameÔºöÂØπÁ´Øruntime_checksums_values‰∏≠Êä•ÂëäÁöÑÊ®°ÂùóÂêçÁß∞
- versionÔºöÂØπÁ´Øruntime_checksum_values‰∏≠Êä•ÂëäÁöÑchecksumÁöÑÁâàÊú¨
<strong>Ê≥®ÊÑè</strong>ÔºåProxySQLÂÆû‰æãÂàöÂêØÂä®Êó∂version=1ÔºöProxySQLÂÆû‰æãÂ∞ÜÊ∞∏Ëøú‰∏ç‰ºö‰ªéversion=1ÁöÑÂÆû‰æãÂ§ÑÂêåÊ≠•ÈÖçÁΩÆÊï∞ÊçÆÔºåÂõ†‰∏∫‰∏Ä‰∏™ÂàöÂàöÂêØÂä®ÁöÑProxyQLÂÆû‰æã‰∏çÂ§™ÂèØËÉΩÊòØÁúüÁõ∏ÁöÑÊù•Ê∫êÔºåËøôÂèØ‰ª•Èò≤Ê≠¢Êñ∞ÁöÑËøûÊé•ËäÇÁÇπÁ†¥ÂùèÂΩìÂâçÈõÜÁæ§ÈÖçÁΩÆ
- epochÔºöÂØπÁ´Øruntime_checksums_values‰∏≠Êä•ÂëäÁöÑchecksumÁöÑÊó∂Èó¥Êà≥epochÂÄº
- checksumÔºöÂØπÁ´Øruntime_checksums_values‰∏≠Êä•ÂëäÁöÑchecksumÂÄº
- changed_atÔºöÊé¢ÊµãÂà∞checksumÂèëÁîüÂèòÂåñÁöÑÊó∂Èó¥Êà≥
- updated_atÔºöÊúÄËøë‰∏ÄÊ¨°Êõ¥Êñ∞ËØ•Á±ªÈÖçÁΩÆÁöÑÊó∂Èó¥Êà≥
- diff_checkÔºö‰∏Ä‰∏™ËÆ°Êï∞Âô®ÔºåÁî®‰∫éËÆ∞ÂΩïÊé¢ÊµãÂà∞ÁöÑÂØπÁ´ØÂíåÊú¨Âú∞checksumÂÄºÂ∑≤ÊúâÂ§öÂ∞ëÊ¨°‰∏çÂêå
ÈúÄË¶ÅÁ≠âÂæÖËææÂà∞ÈòàÂÄºÂêéÔºåÊâç‰ºöËß¶ÂèëÈáçÊñ∞ÈÖçÁΩÆ„ÄÇÂâçÈù¢Â∑≤ÁªèËØ¥ÊòéÔºåÂú®Â§ö‰∏™ProxySQLÂÆû‰æãÂêåÊó∂ÊàñÊûÅÁü≠Êó∂Èó¥ÂÜÖÂêåÊó∂Êõ¥ÊîπÈÖçÁΩÆÊó∂ÔºåÂèØ‰ª•ËÆ©ProxySQLÁ≠âÂæÖÂ§öÊ¨°Êé¢Êµã‰πãÂêéÂÜçÂÜ≥ÂÆöÊòØÂê¶‰ªéËøúÁ´ØÂêåÊ≠•ÈÖçÁΩÆ„ÄÇËøô‰∏™Â≠óÊÆµÊ≠£ÊòØÁî®‰∫éËÆ∞ÂΩïÊé¢ÊµãÂà∞ÁöÑÈÖçÁΩÆ‰∏çÂêåÊ¨°Êï∞„ÄÇÂ¶ÇÊûúdiff_checks‰∏çÊñ≠Â¢ûÂä†Âç¥‰ªçÊú™Ëß¶ÂèëÂêåÊ≠•Êìç‰ΩúÔºåËøôÊÑèÂë≥ÁùÄÂØπÁ´Ø‰∏çÊòØÂèØ‰ø°‰ªªÁöÑÂêåÊ≠•Ê∫êÔºå‰æãÂ¶ÇÂØπÁ´ØÁöÑversion=1„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÂ¶ÇÊûúÊüêÂØπÁ´ØËäÇÁÇπ‰∏çÂíåProxySQLÈõÜÁæ§‰∏≠ÁöÑÂÖ∂ÂÆÉÂÆû‰æãËøõË°åÈÖçÁΩÆÂêåÊ≠•ÔºåËøôÊÑèÂë≥ÁùÄÈõÜÁæ§Ê≤°ÊúâÂèØ‰ø°‰ªªÁöÑÂêåÊ≠•Ê∫ê„ÄÇËøôÁßçÊÉÖÂÜµÂèØËÉΩÊòØÂõ†‰∏∫ÈõÜÁæ§‰∏≠ÊâÄÊúâÂÆû‰æãÂêØÂä®Êó∂ÁöÑÈÖçÁΩÆÈÉΩ‰∏ç‰∏ÄÊ†∑ÔºåÂÆÉ‰ª¨Êó†Ê≥ïËá™Âä®Âà§Êñ≠Âì™‰∏™ÈÖçÁΩÆÊâçÊòØÊ≠£Á°ÆÁöÑ„ÄÇÂèØ‰ª•Âú®Êüê‰∏™ËäÇÁÇπ‰∏äÊâßË°åload to runtimeÔºå‰ΩøËØ•ËäÇÁÇπË¢´ÈÄâ‰∏æ‰∏∫ËØ•Á±ªÈÖçÁΩÆÁöÑÂèØ‰ø°‰ªªÂêåÊ≠•Ê∫ê„ÄÇ</p>
<h4 id="2stats_proxysql_servers_metrics-Ë°®">2.<strong>stats_proxysql_servers_metrics Ë°®</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">show create table stats.stats_proxysql_servers_metrics;
</span></span><span class="line"><span class="cl">| stats_proxysql_servers_metrics | CREATE TABLE stats_proxysql_servers_metrics (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    response_time_ms INT NOT NULL,
</span></span><span class="line"><span class="cl">    Uptime_s INT NOT NULL,
</span></span><span class="line"><span class="cl">    last_check_ms INT NOT NULL,
</span></span><span class="line"><span class="cl">    Queries INT NOT NULL,
</span></span><span class="line"><span class="cl">    Client_Connections_connected INT NOT NULL,
</span></span><span class="line"><span class="cl">    Client_Connections_created INT NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port) ) |
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩìÊâßË°åshow mysql statusËØ≠Âè•Êó∂ÔºåÊòæÁ§∫‰∏Ä‰∫õÂ∑≤Ê£ÄÁ¥¢Âà∞ÁöÑÊåáÊ†á„ÄÇÂ≠óÊÆµÊÑè‰πâÂ¶Ç‰∏ãÔºö
- hostnameÔºöProxySQLÂÆû‰æã‰∏ªÊú∫Âêç
- portÔºöProxySQLÂÆû‰æãÁ´ØÂè£
- weightÔºöÊä•ÂëäÁªìÊûúÂêåproxysql_servers.weightÂ≠óÊÆµ
- commentÔºöÊä•ÂëäÁªìÊûúÂêåproxysql_servers.commentÂ≠óÊÆµ
- response_time_msÔºöÊâßË°åshow mysql statusÁöÑÂìçÂ∫îÊó∂ÈïøÔºåÂçï‰ΩçÊØ´Áßí
- Uptime_sÔºöProxySQLÂÆû‰æãÁöÑuptimeÔºåÂçï‰ΩçÁßí
- last_check_msÔºöÊúÄËøë‰∏ÄÊ¨°ÊâßË°åcheckË∑ùÁé∞Âú®Â∑≤Â§ö‰πÖÔºåÂçï‰ΩçÊØ´Áßí
- QueriesÔºöËØ•ÂÆû‰æãÂ∑≤ÊâßË°åqueryÁöÑÊï∞Èáè
- Client_Connections_connectedÔºönumber of client&rsquo;s connections connected
- Client_Connections_createdÔºönumber of client&rsquo;s connections created
**Ê≥®ÊÑèÔºö**ÂΩìÂâçËøô‰∫õÁä∂ÊÄÅÂè™‰∏∫debugÁõÆÁöÑÔºå‰ΩÜÊú™Êù•ÂèØËÉΩ‰ºö‰Ωú‰∏∫ËøúÁ®ãÂÆû‰æãÁöÑÂÅ•Â∫∑ÊåáÊ†á„ÄÇ</p>
<h4 id="3stats_proxysql_servers_status">3.stats_proxysql_servers_status</h4>
<p>Currently unused ‚Äì this table was created to show general statistics related to all the services configured in the <code>proxysql_servers</code> table.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Admin&gt; show create table stats.stats_proxysql_servers_status\G
</span></span><span class="line"><span class="cl">*************************** 1. row ***************************
</span></span><span class="line"><span class="cl">       table: stats_proxysql_servers_status
</span></span><span class="line"><span class="cl">Create Table: CREATE TABLE stats_proxysql_servers_status (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    master VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    global_version INT NOT NULL,
</span></span><span class="line"><span class="cl">    check_age_us INT NOT NULL,
</span></span><span class="line"><span class="cl">    ping_time_us INT NOT NULL, checks_OK INT NOT NULL,
</span></span><span class="line"><span class="cl">    checks_ERR INT NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port) )
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="re-configuration">Re-configuration</h4>
<p>Âõ†‰∏∫ÈõÜÁæ§Èó¥ÔºåÊâÄÊúâËäÇÁÇπÈÉΩÊòØÁõ∏‰∫íÁõëÊéßÁöÑ„ÄÇÊØè‰∏™ProxySQLËäÇÁÇπÈÉΩÁõëÊéßÈõÜÁæ§‰∏≠ÁöÑÂÖ∂ÂÆÉÂÆû‰æãÔºåÂÆÉ‰ª¨ÂèØ‰ª•Âø´ÈÄüÊé¢ÊµãÂà∞Êüê‰∏™ÂÆû‰æãÁöÑÈÖçÁΩÆÊòØÂê¶ÂèëÁîüÊîπÂèò„ÄÇÂ¶ÇÊûúÊüêÂÆû‰æãÁöÑÈÖçÁΩÆÂèëÁîüÊîπÂèòÔºåÂÖ∂ÂÆÉÂÆû‰æã‰ºöÊ£ÄÊü•Ëøô‰∏™ÈÖçÁΩÆÂíåËá™Ë∫´ÁöÑÈÖçÁΩÆÊòØÂê¶Áõ∏ÂêåÔºåÂõ†‰∏∫ÂÖ∂ÂÆÉËäÇÁÇπÁöÑÈÖçÁΩÆÂèØËÉΩÂíåÊú¨ËäÇÁÇπÁöÑÈÖçÁΩÆÂêåÊó∂(ÊàñÂú®ÊûÅÁü≠Êó∂Èó¥Â∑ÆËåÉÂõ¥)ÂèëÁîü‰∫ÜÊîπÂèò„ÄÇ</p>
<p>Áî±‰∫éÁõ∏‰∫íÁõëÊéßÔºåÊâÄ‰ª•ÂΩìÈÖçÁΩÆÂèëÁîüÂèòÂä®Êó∂ÔºåÂÆÉ‰ª¨ÂèØ‰ª•Á´ãÂç≥ÂèëÁé∞„ÄÇÂΩìÂÖ∂‰ªñËäÇÁÇπÁöÑÈÖçÁΩÆÂèëÁîüÂèòÂä®Êó∂ÔºåÊú¨ËäÇÁÇπ‰ºöÂÖàÂéªÊ£ÄÊü•‰∏ÄÊ¨°ÂÆÉËá™Ë∫´ÁöÑÈÖçÁΩÆÔºåÂõ†‰∏∫ÊúâÂèØËÉΩremote instance Âíålocal instance ÂêåÊó∂ÂèëÁîüÈÖçÁΩÆÂèòÂä®„ÄÇ
Â¶ÇÊûúÊØîËæÉÁªìÊûú‰∏çÂêåÔºö
<strong>-</strong> Â¶ÇÊûúÂÆÉ‰ª¨Ëá™Ë∫´ÁöÑ version = 1ÔºåÂ∞±ÂéªÊâæÈõÜÁæ§ÂÜÖ‰ªéversion &gt; 1ÁöÑËäÇÁÇπÂ§ÑÊâæÂá∫epochÊúÄÂ§ßÂÄºÁöÑËäÇÁÇπÔºåÂπ∂‰ªéËØ•ËäÇÁÇπÊãâÂèñÈÖçÁΩÆÂ∫îÁî®Âà∞Êú¨Âú∞ÔºåÂπ∂Á´ãÂç≥ÂêåÊ≠•„ÄÇ
<strong>-</strong> Â¶ÇÊûúversion &gt;1Ôºå ËØ•ËäÇÁÇπÂºÄÂßãÁªüËÆ°ÂíåÂÖ∂‰ªñËäÇÁÇπÈó¥ÁöÑdiffer Êï∞„ÄÇÂç≥ÂºÄÂßãÂØπÊé¢ÊµãÂà∞ÁöÑ‰∏çÂêåÈÖçÁΩÆËøõË°åËÆ°Êï∞„ÄÇ
<strong>-</strong>  ÂΩì differ Â§ß‰∫é cluster__name___diffs_before_sync Ôºå  Âπ∂‰∏îcluster__name__diffs_before_sync &gt; 0Ôºå Â∞±ÂéªÊâæÈõÜÁæ§ÂÜÖ version &gt;1Ôºå Âπ∂‰∏îepoch  ÊúÄÈ´òÁöÑËäÇÁÇπÔºåÂπ∂Á´ãÂç≥ÂêåÊ≠•„ÄÇ‰πüÂ∞±ÊòØËØ¥ÂΩìÊé¢ÊµãÂà∞‰∏çÂêåÈÖçÁΩÆÁöÑÊ¨°Êï∞Ë∂ÖËøácluster_name_diffs_before_syncÔºå‰∏îcluster_name_diffs_before_syncÂ§ß‰∫é0Êó∂ÔºåÊâæÂá∫version &gt; 1‰∏îepochÂÄºÊúÄÂ§ßÁöÑËäÇÁÇπÔºåÂπ∂‰ªéËØ•ËäÇÁÇπÊãâÂèñÈÖçÁΩÆÁ¶ÅÁî®Â∫îÁî®„ÄÇ</p>
<p>ÂêåÊ≠•ÈÖçÁΩÆÁöÑËøáÁ®ãÂ¶Ç‰∏ãÔºö
<strong>-</strong> Áî®‰∫éÂÅ•Â∫∑Ê£ÄÊü•ÁöÑËøûÊé•Ôºå‰πüÁî®Êù•ÊâßË°å‰∏ÄÁ≥ªÂàóÁ±ª‰ºº‰∫éselect _list_of_columns from runtime_moduleÁöÑselectËØ≠Âè•„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">hostgroup_id</span><span class="p">,</span><span class="w"> </span><span class="o">``</span><span class="n">hostname</span><span class="o">``</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">compression</span><span class="p">,</span><span class="w"> </span><span class="n">max_connections</span><span class="p">,</span><span class="w">  </span><span class="n">max_replication_lag</span><span class="p">,</span><span class="w"> </span><span class="n">use_ssl</span><span class="p">,</span><span class="w"> </span><span class="n">max_latency_ms</span><span class="p">,</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="n">runtime_mysql_servers</span><span class="p">;</span><span class="o">``</span><span class="k">SELECT</span><span class="w"> </span><span class="n">writer_hostgroup</span><span class="p">,</span><span class="w"> </span><span class="n">reader_hostgroup</span><span class="p">,</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">runtime_mysql_replication_hostgroups</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Âà†Èô§Êú¨Âú∞ÈÖçÁΩÆ„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DELETE FROM mysql_servers;DELETE FROM mysql_replication_hostgroups;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>-</strong> ÂêëÊú¨Âú∞ÈÖçÁΩÆË°®‰∏≠ÊèíÂÖ•Â∑≤‰ªéËøúÁ´ØËäÇÁÇπÊ£ÄÁ¥¢Âà∞ÁöÑÊñ∞ÈÖçÁΩÆ„ÄÇ
<strong>-</strong> Âú®ÂÜÖÈÉ®ÊâßË°åLOAD module_name TO RUNTIMEÔºöËøô‰ºöÈÄíÂ¢ûÁâàÊú¨Âè∑ÔºåÂπ∂ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑchecksum„ÄÇ
<strong>-</strong> Â¶ÇÊûúcluster_name_save_to_disk=trueÔºåÂÜçÂú®ÂÜÖÈÉ®ÊâßË°åSAVE module_name TO DISK„ÄÇ</p>
<p>ÂèÇËÄÉÊñáÊ°£Ôºöhttps://www.cnblogs.com/kevingrace/p/10411457.html</p>
<h4 id="ËøõË°åÈÖçÁΩÆ">ËøõË°åÈÖçÁΩÆ</h4>
<p>Ë¶Å‰ΩøÁî®ÁöÑVIPÔºö 10.241.10.3</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Êú∫Âô®</th>
<th>ËßíËâ≤</th>
<th>ÂÜÖÁΩëIP</th>
</tr>
</thead>
<tbody>
<tr>
<td>xxx.xxx.xxx.117</td>
<td>ÂéüÊù•Êê≠Âª∫Â•ΩÁöÑproxysql</td>
<td>10.241.10.1</td>
</tr>
<tr>
<td>xxx.xxx.xxx.114</td>
<td>Ë¶ÅÊñ∞Ê∑ªÂä†ÁªÑÂª∫ÈõÜÁæ§ÁöÑproxysql</td>
<td>10.241.10.2</td>
</tr>
</tbody>
</table></div>
<p>ÂÜôÈÖçÁΩÆÊñá‰ª∂ÂíåÂÆûÊó∂‰øÆÊîπÈÉΩÂèØ‰ª•ÔºåËÆ∞Âæó</p>
<p><code>load *** to runtime</code>„ÄÅ<code>save *** to disk</code></p>
<p><strong>1.ËßÑÂÆöÈõÜÁæ§‰ø°ÊÅØÔºàÂú®117‰∏äÔºâ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span>  <span class="n">admin</span><span class="o">-</span><span class="n">admin_credentials</span><span class="o">=</span><span class="s2">&#34;admin:admin;cluster_name:123456&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">admin</span><span class="o">-</span><span class="n">cluster_username</span><span class="o">=</span><span class="s2">&#34;cluster_name&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">admin</span><span class="o">-</span><span class="n">cluster_password</span><span class="o">=</span><span class="s2">&#34;123456&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">admin</span><span class="o">-</span><span class="n">cluster_check_interval_ms</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">set</span> <span class="n">admin</span><span class="o">-</span><span class="n">cluster_check_status_frequency</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="nb">load</span> <span class="n">admin</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">save</span> <span class="n">admin</span> <span class="n">variables</span>  <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">35</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>select * from global_variables;</code>ÂèØ‰ª•Êü•Áúã‰øÆÊîπÁªìÊûú</p>
<p><strong>2.ÂÜôÂÖ•ËäÇÁÇπ‰ø°ÊÅØ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ProxySQL-Admin&gt;  show create table proxysql_servers;
</span></span><span class="line"><span class="cl">| table            | Create Table                                                         
</span></span><span class="line"><span class="cl">| proxysql_servers | CREATE TABLE proxysql_servers (
</span></span><span class="line"><span class="cl">    hostname VARCHAR NOT NULL,
</span></span><span class="line"><span class="cl">    port INT NOT NULL DEFAULT 6032,
</span></span><span class="line"><span class="cl">    weight INT CHECK (weight &gt;= 0) NOT NULL DEFAULT 0,
</span></span><span class="line"><span class="cl">    comment VARCHAR NOT NULL DEFAULT &#39;&#39;,
</span></span><span class="line"><span class="cl">    PRIMARY KEY (hostname, port) ) |
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÜôÂÖ•ËäÇÁÇπ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">insert</span> <span class="n">into</span> <span class="n">proxysql_servers</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span><span class="n">port</span><span class="p">)</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;xxx.xxx.xxx.114&#39;</span><span class="p">,</span><span class="mi">6032</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">insert</span> <span class="n">into</span> <span class="n">proxysql_servers</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span><span class="n">port</span><span class="p">)</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;xxx.xxx.xxx.117&#39;</span><span class="p">,</span><span class="mi">6032</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="nb">load</span> <span class="n">proxysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">runtime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ProxySQL</span><span class="o">-</span><span class="n">Admin</span><span class="o">&gt;</span>  <span class="n">save</span> <span class="n">proxysql</span> <span class="n">servers</span> <span class="n">to</span> <span class="n">disk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏∫‰∫ÜÁªÉ‰π† Âú®Âè¶‰∏Ä‰∏™ËäÇÁÇπÊàë‰ª¨‰ΩøÁî®ÈÖçÁΩÆÊñá‰ª∂ËøõË°å‰øÆÊîπÔºåÂÄºÁöÑÊ≥®ÊÑèÁöÑÊòØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">ËøôÈáåË¶ÅÁâπÂà´Ê≥®ÊÑèÔºö</span>
</span></span><span class="line"><span class="cl"><span class="err">Â¶ÇÊûúÂ≠òÂú®Â¶ÇÊûúÂ≠òÂú®``</span><span class="s2">&#34;proxysql.db&#34;</span><span class="err">``Êñá‰ª∂</span><span class="p">(</span><span class="err">Âú®``</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">proxysql</span><span class="err">``ÁõÆÂΩï‰∏ã</span><span class="p">)</span><span class="err">ÔºåÂàô</span><span class="n">ProxySQLÊúçÂä°Âè™ÊúâÂú®Á¨¨‰∏ÄÊ¨°ÂêØÂä®Êó∂Êâç‰ºöÂéªËØªÂèñproxysql</span><span class="o">.</span><span class="n">cnfÊñá‰ª∂Âπ∂Ëß£Êûê</span><span class="err">ÔºõÂêéÈù¢ÂêØÂä®‰ºöÂ∞±‰∏ç‰ºöËØªÂèñ</span><span class="n">proxysql</span><span class="o">.</span><span class="n">cnfÊñá‰ª∂‰∫Ü</span><span class="err">ÔºÅÂ¶ÇÊûúÊÉ≥Ë¶ÅËÆ©</span><span class="n">proxysql</span><span class="o">.</span><span class="n">cnfÊñá‰ª∂ÈáåÁöÑÈÖçÁΩÆÂú®ÈáçÂêØproxysqlÊúçÂä°ÂêéÁîüÊïà</span><span class="p">(</span><span class="err">Âç≥ÊÉ≥Ë¶ÅËÆ©</span><span class="n">proxysqlÈáçÂêØÊó∂ËØªÂèñÂπ∂Ëß£Êûêproxysql</span><span class="o">.</span><span class="n">cnfÈÖçÁΩÆÊñá‰ª∂</span><span class="p">)</span><span class="err">ÔºåÂàôÈúÄË¶ÅÂÖàÂà†Èô§``</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">proxysql</span><span class="o">/</span><span class="n">proxysql</span><span class="err">``</span><span class="o">.</span><span class="n">dbÊï∞ÊçÆÂ∫ìÊñá‰ª∂</span><span class="err">ÔºåÁÑ∂ÂêéÂÜçÈáçÂêØ</span><span class="n">proxysqlÊúçÂä°</span><span class="err">„ÄÇËøôÊ†∑Â∞±Áõ∏ÂΩì‰∫éÂàùÂßãÂåñÂêØÂä®</span><span class="n">proxysqlÊúçÂä°‰∫Ü</span><span class="err">Ôºå‰ºöÂÜçÊ¨°Áîü‰∫ß‰∏Ä‰∏™Á∫ØÂáÄÁöÑ</span><span class="n">proxysql</span><span class="o">.</span><span class="n">dbÊï∞ÊçÆÂ∫ìÊñá‰ª∂</span><span class="p">(</span><span class="err">Â¶ÇÊûú‰πãÂâçÈÖçÁΩÆ‰∫Ü</span><span class="n">proxysqlÁõ∏ÂÖ≥Ë∑ØÁî±ËßÑÂàôÁ≠â</span><span class="err">ÔºåÂàôÂ∞±‰ºöË¢´ÊäπÊéâ</span><span class="p">)</span><span class="err">„ÄÇ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cp /etc/proxysql.cnf /etc/proxysql.cnf.bak</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># vim /etc/proxysql.cnf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">admin_variables</span><span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">admin_credentials</span><span class="o">=</span><span class="s2">&#34;admin:admin;cluster_name:123456&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       mysql_ifaces=&#34;127.0.0.1:6032;/tmp/proxysql_admin.sock&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">mysql_ifaces</span><span class="o">=</span><span class="s2">&#34;0.0.0.0:6032&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       refresh_interval=2000</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       debug=true</span>
</span></span><span class="line"><span class="cl">        <span class="n">cluster_username</span><span class="o">=</span><span class="s2">&#34;cluster_name&#34;</span>                                  
</span></span><span class="line"><span class="cl">        <span class="n">cluster_password</span><span class="o">=</span><span class="s2">&#34;123456&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cluster_check_interval_ms</span><span class="o">=</span><span class="mi">2000</span>
</span></span><span class="line"><span class="cl">        <span class="n">cluster_check_status_frequency</span><span class="o">=</span><span class="mi">1000</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">proxysql_servers</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">hostname</span><span class="o">=</span><span class="s2">&#34;xxx.xxx.xxx.114&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">port</span><span class="o">=</span><span class="mi">6032</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">hostname</span><span class="o">=</span><span class="s2">&#34;xxx.xxx.xxx.117&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">port</span><span class="o">=</span><span class="mi">6032</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèÈáåÈù¢ÁöÑÂúÜÊã¨Âè∑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl restart proxysql</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ll  /var/lib/proxysql/proxysql.db </span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">proxysql</span> <span class="n">proxysql</span> <span class="mi">196608</span> <span class="n">Oct</span> <span class="mi">20</span> <span class="mi">11</span><span class="p">:</span><span class="mi">11</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">proxysql</span><span class="o">/</span><span class="n">proxysql</span><span class="o">.</span><span class="n">db</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ËßÇÂØüÈõÜÁæ§Áä∂ÂÜµ">ËßÇÂØüÈõÜÁæ§Áä∂ÂÜµ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># mysql -uadmin -padmin -h127.0.0.1 -P6032</span>
</span></span><span class="line"><span class="cl"><span class="n">MySQL</span> <span class="p">[(</span><span class="n">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">stats_proxysql_servers_metrics</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+------------------+----------+---------------+---------+-------------------</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">hostname</span>        <span class="o">|</span> <span class="n">port</span> <span class="o">|</span> <span class="n">weight</span> <span class="o">|</span> <span class="n">comment</span> <span class="o">|</span> <span class="n">response_time_ms</span> <span class="o">|</span> <span class="n">Uptime_s</span> <span class="o">|</span> <span class="n">last_check_ms</span> <span class="o">|</span> <span class="n">Queries</span> <span class="o">|</span> <span class="n">Client_Connections</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+------------------+----------+---------------+---------+-------------------</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span>  <span class="o">|</span> <span class="mi">6032</span> <span class="o">|</span> <span class="mi">0</span>      <span class="o">|</span>         <span class="o">|</span> <span class="mi">0</span>                <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="mi">676276571</span>     <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span> <span class="mi">0</span>                 
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="mi">6032</span> <span class="o">|</span> <span class="mi">0</span>      <span class="o">|</span>         <span class="o">|</span> <span class="mi">0</span>                <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="mi">676276571</span>     <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span> <span class="mi">0</span>                 
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+------------------+----------+---------------+---------+-------------------</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MySQL</span> <span class="p">[(</span><span class="n">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">proxysql_servers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">hostname</span>        <span class="o">|</span> <span class="n">port</span> <span class="o">|</span> <span class="n">weight</span> <span class="o">|</span> <span class="n">comment</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span>  <span class="o">|</span> <span class="mi">6032</span> <span class="o">|</span> <span class="mi">0</span>      <span class="o">|</span>         <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="mi">6032</span> <span class="o">|</span> <span class="mi">0</span>      <span class="o">|</span>         <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+------+--------+---------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">select</span> <span class="n">hostname</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">checksum</span><span class="p">,</span><span class="n">updated_at</span> <span class="n">from</span> <span class="n">stats_proxysql_servers_checksums</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+-------------------+--------------------+------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">hostname</span>        <span class="o">|</span> <span class="n">name</span>              <span class="o">|</span> <span class="n">checksum</span>           <span class="o">|</span> <span class="n">updated_at</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+-----------------+-------------------+--------------------+------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">admin_variables</span>   <span class="o">|</span>                    <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">mysql_query_rules</span> <span class="o">|</span> <span class="mh">0xD331FBA2DFADB529</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">mysql_servers</span>     <span class="o">|</span> <span class="mh">0xF38804B1395AE050</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">mysql_users</span>       <span class="o">|</span> <span class="mh">0xA9B3797834E823FC</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">mysql_variables</span>   <span class="o">|</span>                    <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">117</span> <span class="o">|</span> <span class="n">proxysql_servers</span>  <span class="o">|</span> <span class="mh">0x66124755F5959C8D</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">admin_variables</span>   <span class="o">|</span>                    <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">mysql_query_rules</span> <span class="o">|</span> <span class="mh">0xD331FBA2DFADB529</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">mysql_servers</span>     <span class="o">|</span> <span class="mh">0xF38804B1395AE050</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">mysql_users</span>       <span class="o">|</span> <span class="mh">0xA9B3797834E823FC</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">mysql_variables</span>   <span class="o">|</span>                    <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="mi">114</span> <span class="o">|</span> <span class="n">proxysql_servers</span>  <span class="o">|</span> <span class="mh">0x66124755F5959C8D</span> <span class="o">|</span> <span class="mi">1603245278</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">12</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§ÂêéÂ§öÁúãÊó•Âøó <code>tail -f /var/lib/proxysql/proxysql.log</code>, ËøôÈáå‰ºöÊèêÁ§∫‰Ω†ÈúÄË¶ÅÂÅöÂì™‰∫õÊìç‰ΩúÊàñÊòØ‰øÆÊîπÂèòÈáèÊù•ËøõË°åÂêåÊ≠•„ÄÇÊ≥®ÊÑèproxysql Ë¥¶Âè∑ÂíåmonitorË¥¶Âè∑Âú®mysqlÊú∫Âô®‰∏äÊòØÂê¶ÊúâÈôêÂà∂„ÄÇ</p>
<p>ÈÄöËøáË∞ÉËØï‰ΩøÂæóproxysql.logÊó†Êä•ÈîôÂêé„ÄÇ</p>
<p>ÈÄöËøá<code>select * from mysql_servers;</code>ËßÇÂØüÊï∞ÊçÆÊó∂ÂÄôÂêåÊ≠•</p>
<p>‰∏ãÈù¢ËøõË°åÈ´òÂèØÁî®ÈÖçÁΩÆ„ÄÇ</p>
<h4 id="proxysqlÁöÑÈ´òÂèØÁî®">ProxysqlÁöÑÈ´òÂèØÁî®</h4>
<p>‰ΩøÁî®keepalived,</p>
<h3 id="keepalived-ÂÆòÊñπÁΩëÁ´ô-httpswwwkeepalivedorg">Keepalived ÂÆòÊñπÁΩëÁ´ô <a class="link" href="https://www.keepalived.org/"  target="_blank" rel="noopener"
    >https://www.keepalived.org/</a></h3>
<p>Âü∫‰∫éÔºàVitual Router Redundancy ProtocolÔºåËôöÊãüË∑ØÁî±ÂÜó‰ΩôÂçèËÆÆÔºâ,VRRPÊòØ‰∏∫‰∫ÜËß£ÂÜ≥ÈùôÊÄÅË∑ØÁî±ÁöÑÈ´òÂèØÁî®„ÄÇVRRPÁöÑÂü∫Êú¨Êû∂ÊûÑ„ÄÇÂà©Áî®VIPËµÑÊ∫êÊºÇÁßªÊù•ÂÆûÁé∞ProxySQLÂèåËäÇÁÇπÁöÑÊó†ÊÑüÁü•ÊïÖÈöúÂàáÊç¢ÔºåÂç≥ÂØπÂ§ñÊèê‰æõ‰∏Ä‰∏™Áªü‰∏ÄÁöÑvipÂú∞ÂùÄÔºåÂπ∂‰∏îÂú®keepalived.confÊñá‰ª∂‰∏≠ÈÖçÁΩÆproxysqlÊúçÂä°ÁöÑÁõëÊéßËÑöÊú¨ÔºåÂΩìÂÆïÊú∫ÊàñproxysqlÊúçÂä°ÊåÇÊéâÊó∂Â∞±Â∞ÜvipËµÑÊ∫êÊºÇÁßªÂà∞Âè¶‰∏Ä‰∏™Ê≠£Â∏∏ÁöÑËäÇÁÇπ‰∏äÔºå‰ªéËÄå‰ΩøproxysqlÁöÑ‰ª£ÁêÜÂ±ÇÊåÅÁª≠Êó†ÊÑüÂ∫îÂú∞Êèê‰æõÊúçÂä°„ÄÇ</p>
<h4 id="vrrpÁöÑÂü∫Êú¨Êû∂ÊûÑ">VRRPÁöÑÂü∫Êú¨Êû∂ÊûÑ</h4>
<p>ËôöÊãüË∑ØÁî±Âô®Áî±Â§ö‰∏™Ë∑ØÁî±Âô®ÁªÑÊàêÔºåÊØè‰∏™Ë∑ØÁî±Âô®ÈÉΩÊúâÂêÑËá™ÁöÑIPÂíåÂÖ±ÂêåÁöÑVRID(0-255)ÔºåÂÖ∂‰∏≠‰∏Ä‰∏™VRRPË∑ØÁî±Âô®ÈÄöËøáÁ´ûÈÄâÊàê‰∏∫MASTERÔºåÂç†ÊúâVIPÔºåÂØπÂ§ñÊèê‰æõË∑ØÁî±ÊúçÂä°ÔºåÂÖ∂‰ªñÊàê‰∏∫BACKUPÔºåMASTER‰ª•IPÁªÑÊí≠ÔºàÁªÑÊí≠Âú∞ÂùÄÔºö224.0.0.18ÔºâÂΩ¢ÂºèÂèëÈÄÅVRRPÂçèËÆÆÂåÖÔºå‰∏éBACKUP‰øùÊåÅÂøÉË∑≥ËøûÊé•ÔºåËã•MASTER‰∏çÂèØÁî®ÔºàÊàñBACKUPÊé•Êî∂‰∏çÂà∞VRRPÂçèËÆÆÂåÖÔºâÔºåÂàôBACKUPÈÄöËøáÁ´ûÈÄâ‰∫ßÁîüÊñ∞ÁöÑMASTERÂπ∂ÁªßÁª≠ÂØπÂ§ñÊèê‰æõË∑ØÁî±ÊúçÂä°Ôºå‰ªéËÄåÂÆûÁé∞È´òÂèØÁî®„ÄÇ
ÈìæÊé•Ôºöhttps://www.jianshu.com/p/b050d8861fc1</p>
<h4 id="Â∑•‰ΩúÁ±ªÂûã">Â∑•‰ΩúÁ±ªÂûã</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Êä¢Âç†ÂºèÔºöÂΩìÂá∫Áé∞ÊØîÁé∞Êúâ‰∏ªÊúçÂä°Âô®‰ºòÂÖàÁ∫ßÈ´òÁöÑÊúçÂä°Âô®Êó∂Ôºå‰ºöÂèëÈÄÅÈÄöÂëäÊä¢Âç†ËßíËâ≤Êàê‰∏∫‰∏ªÊúçÂä°Âô®
</span></span><span class="line"><span class="cl">ÈùûÊä¢Âç†ÂºèÔºö
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê†∏ÂøÉÁªÑ‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">        vrrp stackÔºövrrpÂçèËÆÆÁöÑÂÆûÁé∞
</span></span><span class="line"><span class="cl">        ipvs wrapperÔºö‰∏∫ÈõÜÁæ§ÂÜÖÁöÑÊâÄÊúâËäÇÁÇπÁîüÊàêIPVSËßÑÂàô
</span></span><span class="line"><span class="cl">        checkersÔºöÂØπIPVSÈõÜÁæ§ÁöÑÂêÑRSÂÅöÂÅ•Â∫∑Áä∂ÊÄÅÊ£ÄÊµã
</span></span><span class="line"><span class="cl">        ÊéßÂà∂ÁªÑ‰ª∂ÔºöÈÖçÁΩÆÊñá‰ª∂ÂàÜÊûêÂô®ÔºåÁî®Êù•ÂÆûÁé∞ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂàÜÊûêÂíåÂä†ËΩΩ
</span></span><span class="line"><span class="cl">        IOÂ§çÁî®Âô®
</span></span><span class="line"><span class="cl">        ÂÜÖÂ≠òÁÆ°ÁêÜÁªÑ‰ª∂ÔºåÁî®Êù•ÁÆ°ÁêÜkeepalivedÈ´òÂèØÁî®ÊòØÁöÑÂÜÖÂ≠òÁÆ°ÁêÜ
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê≥®ÊÑèÔºöÂêÑËäÇÁÇπÊó∂Èó¥ÈúÄË¶ÅÂêåÊ≠•</strong></p>
<h5 id="‰∏ãËΩΩÂíåÂÆâË£Ö">‰∏ãËΩΩÂíåÂÆâË£Ö</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> wget https://www.keepalived.org/software/keepalived-2.1.5.tar.gz
</span></span><span class="line"><span class="cl"> tar -xvf keepalived-2.1.5.tar.gz 
</span></span><span class="line"><span class="cl"> cd keepalived-2.1.5
</span></span><span class="line"><span class="cl"> ./configure --prefix=/usr/local/keepalived
</span></span><span class="line"><span class="cl"> yum -y install openssl
</span></span><span class="line"><span class="cl"> make &amp;&amp; make install
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="Âü∫Êú¨ÈÖçÁΩÆ">Âü∫Êú¨ÈÖçÁΩÆ</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># tree -l /usr/local/keepalived/etc
</span></span><span class="line"><span class="cl">-- keepalived
</span></span><span class="line"><span class="cl">|   |-- keepalived.conf
</span></span><span class="line"><span class="cl">|   `-- samples #Ëøô‰∏™ÈáåÈù¢ÊòØ‰æãÂ≠êÔºåÂÖà‰∏çÁÆ°‰ªñ
</span></span><span class="line"><span class="cl">`-- sysconfig
</span></span><span class="line"><span class="cl">    `-- keepalived
</span></span><span class="line"><span class="cl"># mkdir /etc/keepalived
</span></span><span class="line"><span class="cl">#  cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf
</span></span><span class="line"><span class="cl"># cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/keepalived
</span></span><span class="line"><span class="cl"># chkconfig keepalived on
</span></span><span class="line"><span class="cl"># service keepalived start   #ÂêØÂä®ÊúçÂä°
</span></span><span class="line"><span class="cl"># service keepalived stop    #ÂÅúÊ≠¢ÊúçÂä°
</span></span><span class="line"><span class="cl"># service keepalived restart #ÈáçÂêØÊúçÂä°
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩøÁî®<code>service keepalived start</code>ÂëΩ‰ª§ÂêØÂä®ÊúçÂä°Êó∂ÔºåÈªòËÆ§‰ºöÂ∞Ü<code>/etc/sysconfig/keepalived</code>Êñá‰ª∂‰∏≠<code>KEEPALIVED_OPTIONS</code>ÂèÇÊï∞‰Ωú‰∏∫<code>keepalived</code>ÊúçÂä°ÂêØÂä®Êó∂ÁöÑÂèÇÊï∞ÔºåÂπ∂‰ªé<code>/etc/keepalived/</code>ÁõÆÂΩï‰∏ãÂä†ËΩΩkeepalived.confÈÖçÁΩÆÊñá‰ª∂ÔºåÊàñÁî®-fÂèÇÊï∞ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰ΩçÁΩÆ„ÄÇ</p>
<h5 id="ËøõË°åÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰π¶ÂÜô">ËøõË°åÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰π¶ÂÜô</h5>
<p>117 ‰Ωú‰∏∫msater</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">! Configuration File for keepalived
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">global_defs {
</span></span><span class="line"><span class="cl">   script_user root
</span></span><span class="line"><span class="cl">   enable_script_security 
</span></span><span class="line"><span class="cl">   router_id Master-proxysql #Ê†áËØÜÊú¨ËäÇÁÇπÁöÑÂêçÁß∞ÔºåÈÄöÂ∏∏‰∏∫hostname
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">## keepalived‰ºöÂÆöÊó∂ÊâßË°åËÑöÊú¨Âπ∂ÂØπËÑöÊú¨ÊâßË°åÁöÑÁªìÊûúËøõË°åÂàÜÊûê,Âä®ÊÄÅË∞ÉÊï¥vrrp_instanceÁöÑ‰ºòÂÖàÁ∫ß„ÄÇ
</span></span><span class="line"><span class="cl">##Â¶ÇÊûúËÑöÊú¨ÊâßË°åÁªìÊûú‰∏∫0,Âπ∂‰∏îweightÈÖçÁΩÆÁöÑÂÄºÂ§ß‰∫é0,Âàô‰ºòÂÖàÁ∫ßÁõ∏Â∫îÁöÑÂ¢ûÂä†„ÄÇÂ¶ÇÊûúËÑöÊú¨ÊâßË°åÁªìÊûúÈùû0,
</span></span><span class="line"><span class="cl">##Âπ∂‰∏îweightÈÖçÁΩÆÁöÑÂÄºÂ∞è‰∫é 0,Âàô‰ºòÂÖàÁ∫ßÁõ∏Â∫îÁöÑÂáèÂ∞ë„ÄÇÂÖ∂‰ªñÊÉÖÂÜµ,Áª¥ÊåÅÂéüÊú¨ÈÖçÁΩÆÁöÑ‰ºòÂÖàÁ∫ß,Âç≥ÈÖçÁΩÆÊñá‰ª∂‰∏≠priorityÂØπÂ∫îÁöÑÂÄº„ÄÇ
</span></span><span class="line"><span class="cl">vrrp_script chk_proxysql {
</span></span><span class="line"><span class="cl">	script &#34;/etc/keepalived/sql_check.sh&#34;
</span></span><span class="line"><span class="cl">	interval 2 #ÊØè2ÁßíÊ£ÄÊµã‰∏ÄÊ¨°nginxÁöÑËøêË°åÁä∂ÊÄÅ
</span></span><span class="line"><span class="cl">	weight -20 #Â§±Ë¥•‰∏ÄÊ¨°ÔºåÂ∞ÜËá™Â∑±ÁöÑ‰ºòÂÖàÁ∫ß-20
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">vrrp_instance VI_1 {
</span></span><span class="line"><span class="cl">    state MASTER  # Áä∂ÊÄÅÔºå‰∏ªËäÇÁÇπ‰∏∫MASTERÔºåÂ§á‰ªΩËäÇÁÇπ‰∏∫BACKUP
</span></span><span class="line"><span class="cl">    interface eth1  # ÁªëÂÆöVIPÁöÑÁΩëÁªúÊé•Âè£ÔºåÈÄöËøáip aÊü•ÁúãËá™Â∑±ÁöÑÁΩëÁªúÊé•Âè£
</span></span><span class="line"><span class="cl">    virtual_router_id 123 # ËôöÊãüË∑ØÁî±ÁöÑIDÂè∑,‰∏§‰∏™ËäÇÁÇπËÆæÁΩÆÂøÖÈ°ª‰∏ÄÊ†∑,ÂèØÈÄâIPÊúÄÂêé‰∏ÄÊÆµ‰ΩøÁî®,Áõ∏ÂêåÁöÑVRID‰∏∫‰∏Ä‰∏™ÁªÑ,‰ªñÂ∞ÜÂÜ≥ÂÆöÂ§öÊí≠ÁöÑMACÂú∞ÂùÄ
</span></span><span class="line"><span class="cl">    mcast_src_ip 10.241.10.1  # Êú¨Êú∫IPÂú∞ÂùÄ
</span></span><span class="line"><span class="cl">    priority 110 # ËäÇÁÇπ‰ºòÂÖàÁ∫ßÔºåÂÄºËåÉÂõ¥0ÔΩû254ÔºåMASTERË¶ÅÊØîBACKUPÈ´ò
</span></span><span class="line"><span class="cl">    advert_int 1  # ÁªÑÊí≠‰ø°ÊÅØÂèëÈÄÅÊó∂Èó¥Èó¥ÈöîÔºå‰∏§‰∏™ËäÇÁÇπÂøÖÈ°ªËÆæÁΩÆ‰∏ÄÊ†∑ÔºåÈªòËÆ§‰∏∫1Áßí
</span></span><span class="line"><span class="cl">    # ËÆæÁΩÆÈ™åËØÅ‰ø°ÊÅØÔºå‰∏§‰∏™ËäÇÁÇπÂøÖÈ°ª‰∏ÄËá¥
</span></span><span class="line"><span class="cl">    authentication {
</span></span><span class="line"><span class="cl">        auth_type PASS
</span></span><span class="line"><span class="cl">        auth_pass 1111
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    # ËôöÊãüIPÔºå‰∏§‰∏™ËäÇÁÇπËÆæÁΩÆÂøÖÈ°ª‰∏ÄÊ†∑„ÄÇÂèØ‰ª•ËÆæÁΩÆÂ§ö‰∏™Ôºå‰∏ÄË°åÂÜô‰∏Ä‰∏™
</span></span><span class="line"><span class="cl">    virtual_ipaddress {
</span></span><span class="line"><span class="cl">    	10.241.10.3
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    track_script {
</span></span><span class="line"><span class="cl">		chk_proxysql	# nginxÂ≠òÊ¥ªÁä∂ÊÄÅÊ£ÄÊµãËÑöÊú¨		
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>114‰∏∫BACKUP</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">! Configuration File for keepalived
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">global_defs {
</span></span><span class="line"><span class="cl">   script_user root
</span></span><span class="line"><span class="cl">   enable_script_security 
</span></span><span class="line"><span class="cl">   router_id Master-proxysql
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vrrp_script chk_proxysql {
</span></span><span class="line"><span class="cl">	script &#34;/etc/keepalived/sql_check.sh&#34;
</span></span><span class="line"><span class="cl">	interval 2
</span></span><span class="line"><span class="cl">	weight -20
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">vrrp_instance VI_1 {
</span></span><span class="line"><span class="cl">    state BACKUP
</span></span><span class="line"><span class="cl">    interface eth1
</span></span><span class="line"><span class="cl">    virtual_router_id 123
</span></span><span class="line"><span class="cl">    mcast_src_ip 10.241.10.2
</span></span><span class="line"><span class="cl">    priority 100
</span></span><span class="line"><span class="cl">    advert_int 1
</span></span><span class="line"><span class="cl">    authentication {
</span></span><span class="line"><span class="cl">        auth_type PASS
</span></span><span class="line"><span class="cl">        auth_pass 1111
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    virtual_ipaddress {
</span></span><span class="line"><span class="cl">    	10.241.10.3
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    track_script {
</span></span><span class="line"><span class="cl">	chk_proxysql			
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê£ÄÊü•proxysqlÁöÑËÑöÊú¨ <code>cat /etc/keepalived/sql_check.sh</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">echo</span> <span class="s1">&#39;ÊàëÂºÄÂßãËøêË°åÂï¶&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">num</span><span class="o">=</span><span class="sb">`</span>ps aux <span class="p">|</span> grep   proxysql <span class="p">|</span> grep -cv grep<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> ‚ÄòËÆ∞ÂΩïÂ•Ω‰∫Ü‚Äô <span class="nv">$num</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$num</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#ËøôÈáåÂøΩÁï•ÈáçÂêØ</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s1">&#39;ËøõÂÖ•Âà§Êñ≠&#39;</span>
</span></span><span class="line"><span class="cl">        sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>ps aux <span class="p">|</span> grep   proxysql <span class="p">|</span> grep -cv grep<span class="sb">`</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s1">&#39;ËøõÂÖ•Â∞èÂà§Êñ≠&#39;</span>
</span></span><span class="line"><span class="cl">		<span class="nb">echo</span> <span class="s1">&#39;stop keepalived&#39;</span> &gt; /etc/keepalived/chk_log
</span></span><span class="line"><span class="cl">		<span class="nb">kill</span> -9 <span class="k">$(</span>ps aux <span class="p">|</span> grep keepalived <span class="p">|</span> grep -v grep <span class="p">|</span> cut  -d<span class="s1">&#39; &#39;</span> -f 7<span class="k">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">echo</span> <span class="s1">&#39;stop !&#39;</span> &gt; /etc/keepalived/chk_log
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ËÆ∞ÂæóÁªôËÑöÊú¨ÊâßË°åÊùÉÈôê</strong><code>chmod a+x /etc/keepalived/proxysql_check.sh </code></p>
<p>ÂêØÂä®keepalivedÂêé<code>ip a</code>Êü•Áúã</p>
<p>keepalived-masterÁ´Ø</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
</span></span><span class="line"><span class="cl">    link/ether 00:50:56:ab:d7:be brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.241.10.1/16 brd 10.241.255.255 scope global eth1
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet 10.241.10.3/32 scope global eth1
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::250:56ff:feab:d7be/64 scope link 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></td></tr></table>
</div>
</div><p>keepalived-slaveÁ´Ø</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
</span></span><span class="line"><span class="cl">    link/ether 00:50:56:ab:4a:16 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.241.10.2/16 brd 10.241.255.255 scope global eth1
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::250:56ff:feab:4a16/64 scope link 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê£ÄÊü•">Ê£ÄÊü•</h3>
<p>„ÄêÂ∞Ü‰∏ªÊú∫proxysqlÂÖ≥Èó≠Ôºå‰ºöÂèëÁé∞‰∏ªÊú∫‰∏äÁöÑkeepalivedÂÖ≥Èó≠Ôºå<code>vip:10.241.10.3</code> È£òÁßªÂà∞‰∫Ü‰ªéÊú∫Âô®„Äë</p>
<p>‰ΩøÁî®È£òÁßªVIPËøûÊé•MYSQL</p>
<p>Âú®ËØªÂÜôÊúüÈó¥ËøõË°å‰ªéÊú∫ÂàáÊç¢Êñ∞Âª∫<code>test</code>Êï∞ÊçÆÂ∫ì <code>test</code>Êï∞ÊçÆË°®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">databases</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+--------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">Database</span>           <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+--------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">information_schema</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">dbtest</span>             <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">hanzhongtest</span>       <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">mysql</span>              <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">performance_schema</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">sys</span>                <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+--------------------+</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">database</span> <span class="n">proxysqlHA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">proxysqlHA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Database</span> <span class="n">changed</span>
</span></span><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">test_id</span><span class="p">(</span><span class="n">id</span> <span class="ne">int</span><span class="p">,</span><span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®pythonÂÜôÂÖ•Êó∂ÔºåËøõË°åÂàáÊç¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import pymysql
</span></span><span class="line"><span class="cl">config = {
</span></span><span class="line"><span class="cl">&#39;host&#39; : &#39;10.241.10.3&#39;,
</span></span><span class="line"><span class="cl">&#39;db&#39; : &#39;proxysqlHA&#39;,
</span></span><span class="line"><span class="cl">&#39;user&#39; : &#39;proxysql&#39;,
</span></span><span class="line"><span class="cl">&#39;password&#39; : &#39;Proxy-123456&#39;,
</span></span><span class="line"><span class="cl">&#39;port&#39; : 6033,
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">for i in range(1,1000000):
</span></span><span class="line"><span class="cl">insertstr = &#34;insert into test_id values(%s,&#39;zhangsan%s&#39;)&#34; % (i,str(i),i)
</span></span><span class="line"><span class="cl">print(insertstr)
</span></span><span class="line"><span class="cl">sqlstr = insertstr
</span></span><span class="line"><span class="cl">db = pymysql.connect(**config)
</span></span><span class="line"><span class="cl">cursor = db.cursor()
</span></span><span class="line"><span class="cl">cursor.execute(sqlstr)
</span></span><span class="line"><span class="cl">db.commit()
</span></span><span class="line"><span class="cl">print(&#34;count: {}&#34;.format(i) )
</span></span><span class="line"><span class="cl">db.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ÂºÄÂßãÂÜôÂÖ•ÂêéÂÖ≥Èó≠117‰∏ªÊú∫ÁöÑproxysqlÔºåËßÇÂØüÂèëÁé∞Á°ÆÂÆûÂú®ÂàáÊç¢ËøáÁ®ãÁöÑ‰∏ÄÁû¨Èó¥‰ºöÂá∫Áé∞ÂÜôÂÖ•Â§±Ë¥•„ÄÇÂàáÊç¢ÂÆåÊàêÂêéËÆøÈóÆÊ≠£Â∏∏„ÄÇ</p>
<h3 id="ÈÅáÂà∞ÁöÑÈóÆÈ¢ò-1">ÈÅáÂà∞ÁöÑÈóÆÈ¢ò</h3>
<p>1.ÂøòËÆ∞Â∞ÜÊ£ÄÊü•ËÑöÊú¨ÂºÑÊàêÊâßË°åÊùÉÈôê</p>
<p>2.ËÑöÊú¨ÁöÑÂêçÂ≠óÂÆåÂÖ®ÂåÖÂê´‰∫Üproxysql ÂØºËá¥Ê£ÄÊü•Âá∫Èîô„ÄÇ</p>
<p>3.ÂàáÊç¢Êó∂Èó¥ÂåÖÊã¨ keepalivedËøêË°åËÑöÊú¨ÁöÑÈó¥ÈöîÊó∂Èó¥„ÄÅÊ£ÄÊü•ËÑöÊú¨ÁöÑsleepÊó∂Èó¥„ÄÅÁªÑÊí≠‰ø°ÊÅØÈó¥ÈöîÁöÑÊó∂Èó¥„ÄÇÊÉ≥Ë¶ÅÊúÄÂ∞èÂåñÊó∂Èó¥ÈúÄË¶ÅÂ∞ÜÊâÄÊúâÈó¥ÈöîÂíåsleepÂáèÂéª„ÄÇ</p>
<p>‰ΩÜÊòØÁªÑÊí≠‰ø°ÊÅØÈó¥ÈöîÊó∂Èó¥<code>vrrp version 2</code> ‰∏≠ÊúÄÂ∞èÂè™ËÉΩÂà∞1s ÈªòËÆ§ÂêØÂä®<code>vrrp version 2</code></p>
<hr>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/proxysql/">proxysql</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/etcd-%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E5%AE%9A/">
        
        

        <div class="article-details">
            <h2 class="article-title">Etcd ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/ansible-%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E5%AE%9A/">
        
        

        <div class="article-details">
            <h2 class="article-title">Ansible ‰∏ÄÁØáÊñáÁ´†ÊêûÂÆö</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["//unpkg.com/@waline/emojis@1.1.0/bilibili","//unpkg.com/@waline/emojis@1.1.0/weibo","cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji","cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/alus","cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq","cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba"],"locale":{"admin":"Admin","placeholder":"ËØ∑ÊñáÊòéÂèëË®ÄÂìü „Éæ(‚âß‚ñΩ‚â¶*)o"},"pageview":true,"requiredMeta":["name","email","url"],"serverURL":"https://app-production-dfd0.up.railway.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 hanzhongzi
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.21.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
