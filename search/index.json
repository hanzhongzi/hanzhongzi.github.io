[{"content":"Welcome to Hugo theme Stack. This is your first post. Edit or delete it, then start writing!\nFor more information about this theme, check the documentation: https://stack.jimmycai.com/\nWant a site like this? Check out hugo-theme-stack-stater\nPhoto by Pawel Czerwinski on Unsplash\n","date":"2022-03-06T00:00:00Z","image":"https://hanzhongzi.github.io/p/hello-world/cover_hud7e36f7e20e71be184458283bdae4646_55974_120x120_fill_q75_box_smart1.jpg","permalink":"https://hanzhongzi.github.io/p/hello-world/","title":"Hello World"},{"content":"Ansible 一篇搞定，快速学习\n一、特点 模块化： 调用特定的模块，完成特定的内容 使用 Paramiko(Python对于ssh的实现)，PyYAML,Jinja2(模板语言) 三个关键模块 支持自定义模块，可以使用任何语言编写 基于Python实现 不是简单，基于Python和SSH,无agent，无需代理，不依赖PKI(无需SSL) 安全，基于OpenSSH 幂等性：一个任务执行一遍和N边结果是一样的（要注意代码逻辑） 支持playbook编排任务，YAML格式，编排任务，支持丰富的数据机构 较强大的role的多层解决方案 二、架构 1 2 3 4 5 用户/PLAYBOOK =\u0026gt; INVENTORY/API/MODULES/PLUGINS =\u0026gt; HOSTS/NETWORK INVEMTORY: Ansible管理主机的清单 /etc/ansible/hosts MODULES: Ansible执行命令的功能模块、多数为内置核心模块，也可以自定义 PLUGINS: 模块功能的补充，如连接类型插件、循环插件、变量插件、过滤插件等 API: 供第三方程序调用的应用程序接口 用户直接使用命令或者使用 Playbook 或者 调用API 去远程主机执行命令 三、注意事项 执行ansible的主机一般称为主控端，中控，master或堡垒机 主控段python需要在2.6或以上 被控端python版本小鱼2.4的需要安装 python-simplejson windows不能作为主控 四、安装 epel源rpm包安装 sudo yum -y install epel-release \u0026amp;\u0026amp; sudo yum -y install ansible\n官方其他安装方式\n查看安装版本和命令\n1 2 3 4 5 6 7 8 ansible --version ansible 2.9.27 config file = /etc/ansible/ansible.cfg configured module search path = [u\u0026#39;/root/.ansible/plugins/modules\u0026#39;, u\u0026#39;/usr/share/ansible/plugins/modules\u0026#39;] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2.7.5 (default, Nov 16 2020, 22:23:17) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] rpm -ql ansible 可以查看ansible都下载了哪些文件。 也可以在终端输入ansible 后Tab 键查看输出的命令\n五、基本使用 准备机器 节点名称 节点IP 角色 k8s-master-001 10.241.12.3 Ansible-Server k8s-master-003 10.241.12.1 被控制端 k8s-master-002 10.241.12.2 被控制端 k8s-node-003 10.241.12.9 被控制端 k8s-node-001 10.241.12.12 被控制端 anisble管理主机的方式 Ad-HC 即利用ansible命令，主要用于临时命令场景 Ansible-playbook 主要用于长期规划好的，大型项目的使用，需要有前期的规划过程。 配置文件 /etc/ansible/ansible.cfg #主配置文件，配置ansible工作 1 2 3 4 5 6 7 8 9 10 11 12 13 [defaults] inventory = /etc/ansible/hosts #主机列表 library = /usr/share/my_modules #库文件存放目录 remote_tmp = $HOME/.ansible/tmp #临时 py 命令文件存放在远程主机目录 local_tmp = $HOME/.ansible/tmp #本机的临时命令执行目录 forks = 5 #默认并发数量 sudo_user = root #默认sudo用户 ask_sudo_pass = True #每次执行ansible 命令是否询问ssh密码 ask_pass = True remote_port =22 host_key_checking = False #检查对应服务器的host_key, 建议取消注释 log_path = /var/log/ansible.log #日志文件 建议启用 module_name = command #默认模块，可以修改为shell模块 /etc/ansible/hosts #主机清单 为了批量快捷的管理部分主机 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #举例子 #[标签名] #ip1 #ip2 #ip3:222 #将下面的配置写入 /etc/ansible/hosts [k8s-master] #k8s-master-003 10.241.12.1 #k8s-master-002 10.241.12.2 [k8s-slave] #k8s-node-003 10.241.12.9 #k8s-node-001 10.241.12.12 /etc/ansible/role #存放角色 ansible-doc 命令文档 此命令用来显示模块的帮助文档 格式\n1 2 3 4 5 ansible-doc [OPTION] [MODULE...] -l , --list #列出可用模块 -s , --snippet #显示指定模块的playbook片段 例子 ansible-doc -s ping ansible 命令 使用SSH协议实现对远程主机的配置。 所以主控端需要能基于密钥认证的方式联系哥哥被管理节点\n1 2 3 4 5 6 7 #例如使用sshpass批量实现key的验证 ssh-keygen -f /root/.ssh/id_rsa -P \u0026#39;\u0026#39; NET= 192.168.100 export SSHPASS=xxxx for IP in {1..200};do sshpass -e ssh-copy-id $NET.$IP done 格式 1 ansible \u0026lt;host_pattern\u0026gt; [ -m module_name] [-a args] 重要选项说明 1 2 3 4 5 6 7 8 9 10 11 --version #显示版本 -m moudle #指定模块，默认为command -v #详细过程 -vv -vvv 更加详细 --list-hosts #列出主机列表 -k, --ask-pass #提示输入ssh连接密码，默认key验证 -C, --check #检查，并不执行 -T, --timeout=TIMEOUT #执行远程命令的用户,默认10S -u，--user=PEMOTE_USER #执行园长执行的用户 -b, --become #代替旧版的sudo 切换 --beconme-user=USERNAME #指定sudo的runas用户，默认为root -K, --ask-becomne-pass #提示输入sudo时的口令 举例使用ping模块\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # ansible all -m ping 或者 ansible k8s-master#这里指定了hosts里写的标签组 -m ping [WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details 10.241.12.1 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 10.241.12.12 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 10.241.12.2 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 10.241.12.9 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 如果没有验证通过，需要 -k 来输入密码，很麻烦。所以建议使用秘钥。\n选择特定主机 1 2 3 4 5 6 7 8 9 10 11 12 13 [root@k8s-master-001 ~]# ansible all --list-hosts [WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details hosts (4): 10.241.12.9 10.241.12.12 10.241.12.1 10.241.12.2 #或者指定标签组 [root@k8s-master-001 ~]# ansible k8s-master --list-hosts [WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details hosts (2): 10.241.12.1 10.241.12.2 使用通配符指定主机\n1 2 3 4 5 ansible \u0026#39;*\u0026#39; --list-hosts ansible 10.241.* --list-hosts ansible 10.241.12.1:10.241.12.2 --list-hosts #俩个机器中的一个 ，或者关系 ansible \u0026#39;k8s-master:\u0026amp;k8s-node\u0026#39; --list-hosts #与的关系，在k8s-master标签组里也在k8s-node里面 ansible \u0026#39;k8s-master:!k8s-node\u0026#39; --list-hosts #非得关系，在k8s-master标签组里但不在 k8s-node里面 正则表达式选择主机\n1 ansible \u0026#39;~(k8s-master|k8s-node)\u0026#39; -m ping Ansible 执行命令的过程 1.加载 默认的/etc/ansible/ansible.cfg 2.加载自己对应的模块文件，如 command 3.通过ansible将模块或者命令生成对应的临时py文件，将文件传输至远程服务器对应执行用户的$HOME/.ansible/tmp/ansible-tmp-数字/xxx.py 4.赋予执行权限 5.执行并且返回结果 6.删除py文件，退出\nansible执行的状态 在 /etc/ansible/ansible.cfg 的 [colers] 模块中有颜色的详细说明\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 [colors] #highlight = white #verbose = blue #warn = bright purple #error = red #debug = dark gray #deprecate = purple #skip = cyan #unreachable = red #ok = green #changed = yellow #diff_add = green #diff_remove = red #diff_lines = cyan ansible-galaxy # ansible 使用别人下载的工具 此工具会链接 https://galaxy.ansible.com 下载对应的roles\n列出已经安装的galaxy\n1 ansible-galaxy list 下载对应的 roles\n1 2 3 4 5 6 7 # ansible-galaxy install pogosoftware.etcd #返回内容\u0026#34; #- downloading role \u0026#39;etcd\u0026#39;, owned by pogosoftware #- downloading role from https://github.com/pogosoftware/ansible-role-etcd/archive/v1.0.2.tar.gz #- extracting pogosoftware.etcd to /root/.ansible/roles/pogosoftware.etcd #- pogosoftware.etcd (v1.0.2) was installed successfully 查看里面的roles结构\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 tree /root/.ansible/roles/pogosoftware.etcd /root/.ansible/roles/pogosoftware.etcd ├── defaults │ └── main.yml ├── handlers │ └── main.yml ├── LICENSE ├── meta │ └── main.yml ├── tasks │ ├── etcd_user.yml │ └── main.yml └── templates └── etcd.service.j2 5 directories, 7 files #可以 cp -a 一个文件名称然后再里面改自己的定制化需求 删除galaxy\n1 ansible-galaxy remove pogosoftware.etcd ansible-pull 将ansible的命令推送至远程\nansible-palybook (后面有详解) 此工具用于编写好的playbook任务\n1 2 3 4 5 6 7 8 9 10 cat hello.yml - hosts: k8s-slave remote_user: root tasks: - name: hello world command: /usr/bin/wall hello world #执行的时候记得打开 k8s-slave中的一个主机终端看效果 ansible k8s-slave --list-host 会发现终端输出了 hello world ansible-vault 加密yml文件 1 2 3 4 5 6 ansible-vaut encrypt hello.yml #加密 会让输入加密口令 ansible-vaut decrypt hello.yml #解密 ansiblt-vault view hello.yml #查看 ansible-vault edit hello.yml #编辑加密文件 ansiblt-vault rekey hello.yml #修改口令 ansiblt-vault create new.yml #创建新文件 ansible-console 可交互命令 支持tab 提示符号格式：\n1 执行用户@当前操作主机组（当期主机组的主机数量）[f:并发数]$ 常用子命令：\n设置并发数量：forks n 例如 forks 10 切换组： cd 主机组 例如 cd web 列出当前主机组例如 list 列出所有的内置命令： ？ 或者help 例子\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ansible-console [WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details Welcome to the ansible console. Type help or ? to list commands. root@all (4)[f:5]$ cd k8s-master root@k8s-master (2)[f:5]$ list 10.241.12.1 10.241.12.2 root@k8s-master (2)[f:5]$ yum name=lftp 10.241.12.1 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;msg\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;rc\u0026#34;: 0, \u0026#34;results\u0026#34;: [ \u0026#34;lftp-4.4.8-12.el7_8.1.x86_64 providing lftp is already installed\u0026#34; ] } ... 六、Ansible 常用模块 Command 模块 ","date":"2024-01-02T16:09:24+08:00","permalink":"https://hanzhongzi.github.io/p/ansible/","title":"Ansible"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;—\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n— Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code A B C D E F Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ultricies, sapien non euismod aliquam, dui ligula tincidunt odio, at accumsan nulla sapien eget ex. Proin eleifend dictum ipsum, non euismod ipsum pulvinar et. Vivamus sollicitudin, quam in pulvinar aliquam, metus elit pretium purus Proin sit amet velit nec enim imperdiet vehicula. Ut bibendum vestibulum quam, eu egestas turpis gravida nec Sed scelerisque nec turpis vel viverra. Vivamus vitae pretium sapien Code Blocks Code block with backticks 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Diff code block 1 2 3 4 5 [dependencies.bevy] git = \u0026#34;https://github.com/bevyengine/bevy\u0026#34; rev = \u0026#34;11f52b8c72fc3a568e8bb4a4cd1f3eb025ac2e13\u0026#34; - features = [\u0026#34;dynamic\u0026#34;] + features = [\u0026#34;jpeg\u0026#34;, \u0026#34;dynamic\u0026#34;] One line code block 1 \u0026lt;p\u0026gt;A paragraph\u0026lt;/p\u0026gt; List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements — abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL + ALT + Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nThe above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2023-09-07T00:00:00Z","permalink":"https://hanzhongzi.github.io/p/markdown-syntax-guide/","title":"Markdown Syntax Guide"},{"content":"Hugo theme Stack supports the creation of interactive image galleries using Markdown. It\u0026rsquo;s powered by PhotoSwipe and its syntax was inspired by Typlog.\nTo use this feature, the image must be in the same directory as the Markdown file, as it uses Hugo\u0026rsquo;s page bundle feature to read the dimensions of the image. External images are not supported.\nSyntax 1 ![Image 1](1.jpg) ![Image 2](2.jpg) Result Photo by mymind and Luke Chesser on Unsplash\n","date":"2023-08-26T00:00:00Z","image":"https://hanzhongzi.github.io/p/image-gallery/2_hubce42636ecacc1a380b462f3110efcec_37455_120x120_fill_q75_box_smart1.jpg","permalink":"https://hanzhongzi.github.io/p/image-gallery/","title":"Image gallery"},{"content":"For more details, check out the documentation.\nBilibili video Tencent video YouTube video Generic video file Your browser doesn't support HTML5 video. Here is a link to the video instead. Gist GitLab Quote Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n― A famous person, The book they wrote Photo by Codioful on Unsplash\n","date":"2023-08-25T00:00:00Z","image":"https://hanzhongzi.github.io/p/shortcodes/cover_huec3c3e34981507583e214021ad1b9a4b_12942_120x120_fill_q75_box_smart1.jpg","permalink":"https://hanzhongzi.github.io/p/shortcodes/","title":"Shortcodes"},{"content":"Stack has built-in support for math typesetting using KaTeX.\nIt\u0026rsquo;s not enabled by default side-wide, but you can enable it for individual posts by adding math: true to the front matter. Or you can enable it side-wide by adding math = true to the params.article section in config.toml.\nInline math This is an inline mathematical expression: $\\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887…$\n1 $\\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887…$ Block math $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n1 2 3 $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$ $$ f(x) = \\int_{-\\infty}^\\infty\\hat f(\\xi),e^{2 \\pi i \\xi x},d\\xi $$\n1 2 3 $$ f(x) = \\int_{-\\infty}^\\infty\\hat f(\\xi)\\,e^{2 \\pi i \\xi x}\\,d\\xi $$ ","date":"2023-08-24T00:00:00Z","permalink":"https://hanzhongzi.github.io/p/math-typesetting/","title":"Math Typesetting"}]